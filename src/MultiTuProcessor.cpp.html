<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>src/MultiTuProcessor.cpp</title>
        <link rel="stylesheet" href="../codestyle-colorful.css">
    </head>
    <body>
        <div class="highlight"><pre><span id="1L" class="Ln"><a href="MultiTuProcessor.hpp.html"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">"MultiTuProcessor.hpp"</span></a></span>
<span id="2L" class="Ln"></span>
<span id="3L" class="Ln"><a href="CgStr.hpp.html"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">"CgStr.hpp"</span></a></span>
<span id="4L" class="Ln"><a href="SimpleTemplate.hpp.html"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">"SimpleTemplate.hpp"</span></a></span>
<span id="5L" class="Ln"><a href="basicHl.hpp.html"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">"basicHl.hpp"</span></a></span>
<span id="6L" class="Ln"><a href="xref.hpp.html"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">"xref.hpp"</span></a></span>
<span id="7L" class="Ln"></span>
<span id="8L" class="Ln"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">&lt;</span><span class="cpf">boost</span><span class="cpf">/</span><span class="cpf">filesystem</span><span class="cpf">.</span><span class="cpf">hpp</span><span class="cpf">></span></span>
<span id="9L" class="Ln"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">&lt;</span><span class="cpf">boost</span><span class="cpf">/</span><span class="cpf">variant</span><span class="cpf">/</span><span class="cpf">variant</span><span class="cpf">.</span><span class="cpf">hpp</span><span class="cpf">></span></span>
<span id="10L" class="Ln"></span>
<span id="11L" class="Ln"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">&lt;</span><span class="cpf">algorithm</span><span class="cpf">></span></span>
<span id="12L" class="Ln"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">&lt;</span><span class="cpf">climits</span><span class="cpf">></span></span>
<span id="13L" class="Ln"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">&lt;</span><span class="cpf">iostream</span><span class="cpf">></span></span>
<span id="14L" class="Ln"></span>
<span id="15L" class="Ln"><span class="kd">using</span> <span class="kd">namespace</span> <a href="output.hpp.html#synth" class="nn">synth</a>;</span>
<span id="16L" class="Ln"></span>
<span id="17L" class="Ln"><span class="kd">static</span> <a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nc">path</span> <span class="def decl nf" id="normalAbsolute:const-fs::path&amp;">normalAbsolute</span><span class="p">(</span><a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nc">path</span> <span class="kd">const</span><span class="p">&amp;</span> <span class="def decl nv">p</span><span class="p">)</span></span>
<span id="18L" class="Ln"><span class="p">{</span></span>
<span id="19L" class="Ln">    <a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nc">path</span> <span class="def decl nv">r</span> <span class="p">=</span> <a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nf">absolute</span><span class="p">(</span><a href="#17L" class="nv">p</a><span class="p">)</span><span class="p">.</span><span class="nf">lexically_normal</span><span class="p">(</span><span class="p">)</span><span class="p">;</span></span>
<span id="20L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="#19L" class="nv">r</a><span class="p">.</span><span class="nf">filename</span><span class="p">(</span><span class="p">)</span> <span class="p">==</span> <span class="s">"."</span><span class="p">)</span></span>
<span id="21L" class="Ln">        <a href="#19L" class="nv">r</a><span class="p">.</span><span class="nf">remove_filename</span><span class="p">(</span><span class="p">)</span><span class="p">;</span></span>
<span id="22L" class="Ln">    <span class="k">return</span> <a href="#19L" class="nv">r</a><span class="p">;</span></span>
<span id="23L" class="Ln"><span class="p">}</span></span>
<span id="24L" class="Ln"></span>
<span id="25L" class="Ln"><span class="c">// Idea from http://stackoverflow.com/a/15549954/2128694, user Rob Kennedy</span></span>
<span id="26L" class="Ln"><span class="kd">static</span> <span class="kt">bool</span> <span class="def decl nf" id="isPathSuffix:const-fs::path&amp;,const-fs::path&amp;">isPathSuffix</span><span class="p">(</span><a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nc">path</span> <span class="kd">const</span><span class="p">&amp;</span> <span class="def decl nv">dir</span><span class="p">,</span> <a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nc">path</span> <span class="kd">const</span><span class="p">&amp;</span> <span class="def decl nv">p</span><span class="p">)</span></span>
<span id="27L" class="Ln"><span class="p">{</span></span>
<span id="28L" class="Ln">    <span class="k">return</span> <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">mismatch</span><span class="p">(</span><a href="#26L" class="nv">dir</a><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <a href="#26L" class="nv">dir</a><span class="p">.</span><span class="nf">end</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <a href="#26L" class="nv">p</a><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <a href="#26L" class="nv">p</a><span class="p">.</span><span class="nf">end</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">.</span><span class="vi">first</span></span>
<span id="29L" class="Ln">        <span class="p">==</span> <a href="#26L" class="nv">dir</a><span class="p">.</span><span class="nf">end</span><span class="p">(</span><span class="p">)</span><span class="p">;</span></span>
<span id="30L" class="Ln"><span class="p">}</span></span>
<span id="31L" class="Ln"></span>
<span id="32L" class="Ln"><span class="kd">static</span> <a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nc">path</span> <span class="def decl nf" id="commonPrefix:const-fs::path&amp;,const-fs::path&amp;">commonPrefix</span><span class="p">(</span><a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nc">path</span> <span class="kd">const</span><span class="p">&amp;</span> <span class="def decl nv">p1</span><span class="p">,</span> <a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nc">path</span> <span class="kd">const</span><span class="p">&amp;</span> <span class="def decl nv">p2</span><span class="p">)</span></span>
<span id="33L" class="Ln"><span class="p">{</span></span>
<span id="34L" class="Ln">    <span class="kd">auto</span> <span class="def decl nv">it1</span> <span class="p">=</span> <a href="#32L" class="nv">p1</a><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <span class="def decl nv">it2</span> <span class="p">=</span> <a href="#32L" class="nv">p2</a><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="p">)</span><span class="p">;</span></span>
<span id="35L" class="Ln">    <a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nc">path</span> <span class="def decl nv">r</span><span class="p">;</span></span>
<span id="36L" class="Ln">    <span class="k">while</span> <span class="p">(</span><a href="#34L" class="nv">it1</a> <span class="p">!=</span> <a href="#32L" class="nv">p1</a><span class="p">.</span><span class="nf">end</span><span class="p">(</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <a href="#34L" class="nv">it2</a> <span class="p">!=</span> <a href="#32L" class="nv">p2</a><span class="p">.</span><span class="nf">end</span><span class="p">(</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span></span>
<span id="37L" class="Ln">        <span class="k">if</span> <span class="p">(</span><span class="p">*</span><a href="#34L" class="nv">it1</a> <span class="p">!=</span> <span class="p">*</span><a href="#34L" class="nv">it2</a><span class="p">)</span></span>
<span id="38L" class="Ln">            <span class="k">break</span><span class="p">;</span></span>
<span id="39L" class="Ln">        <a href="#35L" class="nv">r</a> <span class="p">/=</span> <span class="p">*</span><a href="#34L" class="nv">it1</a><span class="p">;</span></span>
<span id="40L" class="Ln">        <span class="p">++</span><a href="#34L" class="nv">it1</a><span class="p">;</span></span>
<span id="41L" class="Ln">        <span class="p">++</span><a href="#34L" class="nv">it2</a><span class="p">;</span></span>
<span id="42L" class="Ln">    <span class="p">}</span></span>
<span id="43L" class="Ln">    <span class="k">return</span> <a href="#35L" class="nv">r</a><span class="p">;</span></span>
<span id="44L" class="Ln"><span class="p">}</span></span>
<span id="45L" class="Ln"></span>
<span id="46L" class="Ln"><a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor" class="nc">MultiTuProcessor</a><span class="p">::</span><span class="def decl nf" id="synth::MultiTuProcessor::MultiTuProcessor:const-PathMap&amp;,ExternalRefLinker&amp;&amp;">MultiTuProcessor</span><span class="p">(</span></span>
<span id="47L" class="Ln">    <a href="MultiTuProcessor.hpp.html#synth::PathMap" class="nc">PathMap</a> <span class="kd">const</span><span class="p">&amp;</span> <span class="def decl nv">dirs</span><span class="p">,</span> <a href="MultiTuProcessor.hpp.html#synth::ExternalRefLinker" class="nc">ExternalRefLinker</a><span class="p">&amp;&amp;</span> <span class="def decl nv">refLinker</span><span class="p">)</span></span>
<span id="48L" class="Ln">    <span class="p">:</span> <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::m_refLinker" class="vi">m_refLinker</a><span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">move</span><span class="p">(</span><a href="#47L" class="nv">refLinker</a><span class="p">)</span><span class="p">)</span></span>
<span id="49L" class="Ln"><span class="p">{</span></span>
<span id="50L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="#47L" class="nv">dirs</a><span class="p">.</span><span class="nf">empty</span><span class="p">(</span><span class="p">)</span><span class="p">)</span></span>
<span id="51L" class="Ln">        <span class="k">return</span><span class="p">;</span></span>
<span id="52L" class="Ln">    <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::m_rootInDir" class="vi">m_rootInDir</a> <span class="p">=</span> <a href="#47L" class="nv">dirs</a><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="p">)</span><span class="p">-></span><span class="vi">first</span><span class="p">;</span></span>
<span id="53L" class="Ln">    <span class="k">for</span> <span class="p">(</span><span class="kd">auto</span> <span class="kd">const</span><span class="p">&amp;</span> <span class="def decl nv">kv</span> <a href="#53L" class="p">:</a> <a href="#47L" class="nv">dirs</a><span class="p">)</span> <span class="p">{</span></span>
<span id="54L" class="Ln">        <a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nc">path</span> <span class="def decl nv">inDir</span> <span class="p">=</span> <a href="#normalAbsolute:const-fs::path&amp;" class="nf">normalAbsolute</a><span class="p">(</span><a href="#53L" class="nv">kv</a><span class="p">.</span><span class="vi">first</span><span class="p">)</span><span class="p">;</span></span>
<span id="55L" class="Ln">        <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::m_dirs" class="vi">m_dirs</a><span class="p">.</span><span class="nf">push_back</span><span class="p">(</span><span class="p">{</span><a href="#54L" class="nv">inDir</a><span class="p">,</span> <a href="#normalAbsolute:const-fs::path&amp;" class="nf">normalAbsolute</a><span class="p">(</span><a href="#53L" class="nv">kv</a><span class="p">.</span><span class="vi">second</span><span class="p">)</span><span class="p">}</span><span class="p">)</span><span class="p">;</span></span>
<span id="56L" class="Ln">        <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::m_rootInDir" class="vi">m_rootInDir</a> <span class="p">=</span> <a href="#commonPrefix:const-fs::path&amp;,const-fs::path&amp;" class="nf">commonPrefix</a><span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">move</span><span class="p">(</span><a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::m_rootInDir" class="vi">m_rootInDir</a><span class="p">)</span><span class="p">,</span> <a href="#54L" class="nv">inDir</a><span class="p">)</span><span class="p">;</span></span>
<span id="57L" class="Ln">    <span class="p">}</span></span>
<span id="58L" class="Ln"><span class="p">}</span></span>
<span id="59L" class="Ln"></span>
<span id="60L" class="Ln"><span class="kt">bool</span> <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor" class="nc">MultiTuProcessor</a><span class="p">::</span><span class="def decl nf" id="synth::MultiTuProcessor::isFileIncluded:const-fs::path&amp;">isFileIncluded</span><span class="p">(</span><a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nc">path</span> <span class="kd">const</span><span class="p">&amp;</span> <span class="def decl nv">p</span><span class="p">)</span> <span class="kd">const</span></span>
<span id="61L" class="Ln"><span class="p">{</span></span>
<span id="62L" class="Ln">    <span class="k">return</span> <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::getFileMapping:const-fs::path&amp;" class="nf">getFileMapping</a><span class="p">(</span><a href="#60L" class="nv">p</a><span class="p">)</span> <span class="o">!=</span> <span class="kc">nullptr</span><span class="p">;</span></span>
<span id="63L" class="Ln"><span class="p">}</span></span>
<span id="64L" class="Ln"></span>
<span id="65L" class="Ln"><span class="c">// Returns nullptr if references to f should be ignored.</span></span>
<span id="66L" class="Ln"><span class="c">// Pass 0 for lineno and UINT_MAX for offset if referencing</span></span>
<span id="67L" class="Ln"><span class="c">// the file as a whole.</span></span>
<span id="68L" class="Ln"></span>
<span id="69L" class="Ln"><a href="output.hpp.html#synth::SymbolDeclaration" class="nc">SymbolDeclaration</a> <span class="kd">const</span><span class="p">*</span> <a href="xref.hpp.html#synth" class="nn">synth</a><span class="p">::</span><a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor" class="nc">MultiTuProcessor</a><span class="p">::</span><span class="def decl nf" id="synth::MultiTuProcessor::referenceSymbol:CXFile,unsigned-int,unsigned-int">referenceSymbol</span><span class="p">(</span></span>
<span id="70L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#CXFile" class="nc">CXFile</a> <span class="def decl nv">f</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="def decl nv">lineno</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="def decl nv">offset</span><span class="p">)</span></span>
<span id="71L" class="Ln"><span class="p">{</span></span>
<span id="72L" class="Ln">    <a href="MultiTuProcessor.hpp.html#synth::FileEntry" class="nc">FileEntry</a><span class="p">*</span> <span class="def decl nv">fentry</span> <span class="p">=</span> <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::obtainFileEntry:CXFile" class="nf">obtainFileEntry</a><span class="p">(</span><a href="#70L" class="nv">f</a><span class="p">)</span><span class="p">;</span></span>
<span id="73L" class="Ln">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><a href="#72L" class="nv">fentry</a><span class="p">)</span></span>
<span id="74L" class="Ln">        <span class="k">return</span> <span class="kc">nullptr</span><span class="p">;</span></span>
<span id="75L" class="Ln">    <span class="k">return</span> <span class="o">&amp;</span><a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::createSymbol:const-synth::HighlightedFile&amp;,unsigned-int,unsigned-int" class="nf">createSymbol</a><span class="p">(</span><a href="#72L" class="nv">fentry</a><span class="p">-></span><a href="MultiTuProcessor.hpp.html#synth::FileEntry::hlFile" class="vi">hlFile</a><span class="p">,</span> <a href="#70L" class="nv">lineno</a><span class="p">,</span> <a href="#70L" class="nv">offset</a><span class="p">)</span><span class="p">;</span></span>
<span id="76L" class="Ln"><span class="p">}</span></span>
<span id="77L" class="Ln"></span>
<span id="78L" class="Ln"><a href="output.hpp.html#synth::SymbolDeclaration" class="nc">SymbolDeclaration</a><span class="p">&amp;</span> <a href="xref.hpp.html#synth" class="nn">synth</a><span class="p">::</span><a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor" class="nc">MultiTuProcessor</a><span class="p">::</span><span class="def decl nf" id="synth::MultiTuProcessor::createSymbol:const-synth::HighlightedFile&amp;,unsigned-int,unsigned-int">createSymbol</span><span class="p">(</span></span>
<span id="79L" class="Ln">    <a href="output.hpp.html#synth::HighlightedFile" class="nc">HighlightedFile</a> <span class="kd">const</span><span class="p">&amp;</span> <span class="def decl nv">hlFile</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="def decl nv">lineno</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="def decl nv">offset</span><span class="p">)</span></span>
<span id="80L" class="Ln"><span class="p">{</span></span>
<span id="81L" class="Ln">    <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/utility/pair" class="nc">pair</a><span class="p">&lt;</span><a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::SymbolMap" class="nc">SymbolMap</a><span class="p">::</span><span class="nc">iterator</span><span class="p">,</span> <span class="kt">bool</span><span class="p">></span> <span class="def decl nv">inserted</span><span class="p">;</span></span>
<span id="82L" class="Ln">    <span class="p">{</span></span>
<span id="83L" class="Ln">        <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/thread/lock_guard" class="nc">lock_guard</a><span class="p">&lt;</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/thread/mutex" class="nc">mutex</a><span class="p">></span> <span class="def decl nv">lock</span><span class="p">(</span><a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::m_mut" class="vi">m_mut</a><span class="p">)</span><span class="p">;</span></span>
<span id="84L" class="Ln">        <a href="#81L" class="nv">inserted</a> <span class="p">=</span> <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::m_syms" class="vi">m_syms</a><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="p">{</span></span>
<span id="85L" class="Ln">            <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::SymbolId" class="nc">SymbolId</a><span class="p">{</span> <span class="o">&amp;</span><a href="#79L" class="nv">hlFile</a><span class="p">,</span> <a href="#79L" class="nv">offset</a> <span class="p">}</span><span class="p">,</span></span>
<span id="86L" class="Ln">            <a href="output.hpp.html#synth::SymbolDeclaration" class="nc">SymbolDeclaration</a><span class="p">{</span> <span class="o">&amp;</span><a href="#79L" class="nv">hlFile</a><span class="p">,</span> <a href="#79L" class="nv">lineno</a><span class="p">,</span> <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/string/basic_string" class="nc">string</a><span class="p">(</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span><span class="p">)</span><span class="p">;</span></span>
<span id="87L" class="Ln">    <span class="p">}</span></span>
<span id="88L" class="Ln"></span>
<span id="89L" class="Ln">    <span class="k">return</span> <a href="#81L" class="nv">inserted</a><span class="p">.</span><span class="vi">first</span><span class="p">-></span><span class="vi">second</span><span class="p">;</span></span>
<span id="90L" class="Ln"><span class="p">}</span></span>
<span id="91L" class="Ln"></span>
<span id="92L" class="Ln"><a href="MultiTuProcessor.hpp.html#synth::PathMap" class="nc">PathMap</a><span class="p">::</span><span class="nc">value_type</span> <span class="kd">const</span><span class="p">*</span> <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor" class="nc">MultiTuProcessor</a><span class="p">::</span><span class="def decl nf" id="synth::MultiTuProcessor::getFileMapping:const-fs::path&amp;">getFileMapping</span><span class="p">(</span></span>
<span id="93L" class="Ln">    <a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nc">path</span> <span class="kd">const</span><span class="p">&amp;</span> <span class="def decl nv">p</span><span class="p">)</span> <span class="kd">const</span></span>
<span id="94L" class="Ln"><span class="p">{</span></span>
<span id="95L" class="Ln">    <a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nc">path</span> <span class="def decl nv">cleanP</span> <span class="p">=</span> <a href="#normalAbsolute:const-fs::path&amp;" class="nf">normalAbsolute</a><span class="p">(</span><a href="#93L" class="nv">p</a><span class="p">)</span><span class="p">;</span></span>
<span id="96L" class="Ln">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><a href="#isPathSuffix:const-fs::path&amp;,const-fs::path&amp;" class="nf">isPathSuffix</a><span class="p">(</span><a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::m_rootInDir" class="vi">m_rootInDir</a><span class="p">,</span> <a href="#95L" class="nv">cleanP</a><span class="p">)</span><span class="p">)</span></span>
<span id="97L" class="Ln">        <span class="k">return</span> <span class="kc">nullptr</span><span class="p">;</span></span>
<span id="98L" class="Ln"></span>
<span id="99L" class="Ln">    <span class="k">for</span> <span class="p">(</span><span class="kd">auto</span> <span class="kd">const</span><span class="p">&amp;</span> <span class="def decl nv">kv</span> <a href="#99L" class="p">:</a> <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::m_dirs" class="vi">m_dirs</a><span class="p">)</span> <span class="p">{</span></span>
<span id="100L" class="Ln">        <span class="k">if</span> <span class="p">(</span><a href="#isPathSuffix:const-fs::path&amp;,const-fs::path&amp;" class="nf">isPathSuffix</a><span class="p">(</span><a href="#99L" class="nv">kv</a><span class="p">.</span><span class="vi">first</span><span class="p">,</span> <a href="#95L" class="nv">cleanP</a><span class="p">)</span><span class="p">)</span></span>
<span id="101L" class="Ln">            <span class="k">return</span> <span class="o">&amp;</span><a href="#99L" class="nv">kv</a><span class="p">;</span></span>
<span id="102L" class="Ln">    <span class="p">}</span></span>
<span id="103L" class="Ln">    <span class="k">return</span> <span class="kc">nullptr</span><span class="p">;</span></span>
<span id="104L" class="Ln"><span class="p">}</span></span>
<span id="105L" class="Ln"></span>
<span id="106L" class="Ln"><a href="output.hpp.html#synth::HighlightedFile" class="nc">HighlightedFile</a><span class="p">*</span> <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor" class="nc">MultiTuProcessor</a><span class="p">::</span><span class="def decl nf" id="synth::MultiTuProcessor::prepareToProcess:CXFile">prepareToProcess</span><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#CXFile" class="nc">CXFile</a> <span class="def decl nv">f</span><span class="p">)</span></span>
<span id="107L" class="Ln"><span class="p">{</span></span>
<span id="108L" class="Ln">    <a href="MultiTuProcessor.hpp.html#synth::FileEntry" class="nc">FileEntry</a><span class="p">*</span> <span class="def decl nv">fentry</span> <span class="p">=</span> <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::obtainFileEntry:CXFile" class="nf">obtainFileEntry</a><span class="p">(</span><a href="#106L" class="nv">f</a><span class="p">)</span><span class="p">;</span></span>
<span id="109L" class="Ln">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><a href="#108L" class="nv">fentry</a> <span class="o">||</span> <a href="#108L" class="nv">fentry</a><span class="p">-></span><a href="MultiTuProcessor.hpp.html#synth::FileEntry::processed" class="vi">processed</a><span class="p">.</span><a href="http://en.cppreference.com/w/cpp/atomic/atomic_flag/test_and_set" class="nf">test_and_set</a><span class="p">(</span><span class="p">)</span><span class="p">)</span></span>
<span id="110L" class="Ln">        <span class="k">return</span> <span class="kc">nullptr</span><span class="p">;</span></span>
<span id="111L" class="Ln">    <span class="k">return</span> <span class="o">&amp;</span><a href="#108L" class="nv">fentry</a><span class="p">-></span><a href="MultiTuProcessor.hpp.html#synth::FileEntry::hlFile" class="vi">hlFile</a><span class="p">;</span></span>
<span id="112L" class="Ln"><span class="p">}</span></span>
<span id="113L" class="Ln"></span>
<span id="114L" class="Ln"><span class="kt">void</span> <a href="xref.hpp.html#synth" class="nn">synth</a><span class="p">::</span><a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor" class="nc">MultiTuProcessor</a><span class="p">::</span><span class="def decl nf" id="synth::MultiTuProcessor::registerDef:std::string&amp;&amp;,const-synth::SymbolDeclaration*">registerDef</span><span class="p">(</span></span>
<span id="115L" class="Ln">    <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/string/basic_string" class="nc">string</a> <span class="p">&amp;&amp;</span> <span class="def decl nv">usr</span><span class="p">,</span> <a href="output.hpp.html#synth::SymbolDeclaration" class="nc">SymbolDeclaration</a> <span class="kd">const</span><span class="p">*</span> <span class="def decl nv">def</span><span class="p">)</span></span>
<span id="116L" class="Ln"><span class="p">{</span></span>
<span id="117L" class="Ln">    <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/thread/lock_guard" class="nc">lock_guard</a><span class="p">&lt;</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/thread/mutex" class="nc">mutex</a><span class="p">></span> <span class="def decl nv">lock</span><span class="p">(</span><a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::m_mut" class="vi">m_mut</a><span class="p">)</span><span class="p">;</span></span>
<span id="118L" class="Ln">    <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::m_defs" class="vi">m_defs</a><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="p">{</span> <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">move</span><span class="p">(</span><a href="#115L" class="nv">usr</a><span class="p">)</span><span class="p">,</span> <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">move</span><span class="p">(</span><a href="#115L" class="nv">def</a><span class="p">)</span> <span class="p">}</span><span class="p">)</span><span class="p">;</span></span>
<span id="119L" class="Ln"><span class="p">}</span></span>
<span id="120L" class="Ln"></span>
<span id="121L" class="Ln"><a href="MultiTuProcessor.hpp.html#synth::FileEntry" class="nc">FileEntry</a><span class="p">*</span> <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor" class="nc">MultiTuProcessor</a><span class="p">::</span><span class="def decl nf" id="synth::MultiTuProcessor::obtainFileEntry:CXFile">obtainFileEntry</span><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#CXFile" class="nc">CXFile</a> <span class="def decl nv">f</span><span class="p">)</span></span>
<span id="122L" class="Ln"><span class="p">{</span></span>
<span id="123L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#302L" class="nc">CXFileUniqueID</a> <span class="def decl nv">fuid</span><span class="p">;</span></span>
<span id="124L" class="Ln">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><a href="#121L" class="nv">f</a> <span class="o">||</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getFileUniqueID:CXFile,CXFileUniqueID*" class="nf">clang_getFileUniqueID</a><span class="p">(</span><a href="#121L" class="nv">f</a><span class="p">,</span> <span class="o">&amp;</span><a href="#123L" class="nv">fuid</a><span class="p">)</span> <span class="o">!=</span> <span class="m">0</span><span class="p">)</span></span>
<span id="125L" class="Ln">        <span class="k">return</span> <span class="kc">nullptr</span><span class="p">;</span></span>
<span id="126L" class="Ln"></span>
<span id="127L" class="Ln">    <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/thread/lock_guard" class="nc">lock_guard</a><span class="p">&lt;</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/thread/mutex" class="nc">mutex</a><span class="p">></span> <span class="def decl nv">lock</span><span class="p">(</span><a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::m_mut" class="vi">m_mut</a><span class="p">)</span><span class="p">;</span></span>
<span id="128L" class="Ln">    <span class="kd">auto</span> <span class="def decl nv">it</span> <span class="p">=</span> <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::m_processedFiles" class="vi">m_processedFiles</a><span class="p">.</span><span class="nf">find</span><span class="p">(</span><a href="#123L" class="nv">fuid</a><span class="p">)</span><span class="p">;</span></span>
<span id="129L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="#128L" class="nv">it</a> <span class="p">!=</span> <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::m_processedFiles" class="vi">m_processedFiles</a><span class="p">.</span><span class="nf">end</span><span class="p">(</span><span class="p">)</span><span class="p">)</span></span>
<span id="130L" class="Ln">        <span class="k">return</span> <span class="o">&amp;</span><a href="#128L" class="nv">it</a><span class="p">-></span><span class="vi">second</span><span class="p">;</span></span>
<span id="131L" class="Ln">    <a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nc">path</span> <span class="def decl nv">fname</span><span class="p">(</span><a href="CgStr.hpp.html#synth::CgStr" class="nc">CgStr</a><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_getFileName:CXFile" class="nf">clang_getFileName</a><span class="p">(</span><a href="#121L" class="nv">f</a><span class="p">)</span><span class="p">)</span><span class="p">.</span><a href="CgStr.hpp.html#synth::CgStr::gets" class="nf">gets</a><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="132L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="#131L" class="nv">fname</a><span class="p">.</span><span class="nf">empty</span><span class="p">(</span><span class="p">)</span><span class="p">)</span></span>
<span id="133L" class="Ln">        <span class="k">return</span> <span class="kc">nullptr</span><span class="p">;</span></span>
<span id="134L" class="Ln">    <span class="kd">auto</span> <span class="def decl nv">mapping</span> <span class="p">=</span> <a href="#synth::MultiTuProcessor::getFileMapping:const-fs::path&amp;" class="nf">getFileMapping</a><span class="p">(</span><a href="#131L" class="nv">fname</a><span class="p">)</span><span class="p">;</span></span>
<span id="135L" class="Ln">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><a href="#134L" class="nv">mapping</a><span class="p">)</span></span>
<span id="136L" class="Ln">        <span class="k">return</span> <span class="kc">nullptr</span><span class="p">;</span></span>
<span id="137L" class="Ln">    <a href="#131L" class="nv">fname</a> <span class="p">=</span> <a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nf">relative</span><span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">move</span><span class="p">(</span><a href="#131L" class="nv">fname</a><span class="p">)</span><span class="p">,</span> <a href="#134L" class="nv">mapping</a><span class="p">-></span><span class="vi">first</span><span class="p">)</span><span class="p">;</span></span>
<span id="138L" class="Ln">    <a href="MultiTuProcessor.hpp.html#synth::FileEntry" class="nc">FileEntry</a><span class="p">&amp;</span> <span class="def decl nv">e</span> <span class="p">=</span> <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::m_processedFiles" class="vi">m_processedFiles</a><span class="p">.</span><span class="nf">emplace</span><span class="p">(</span></span>
<span id="139L" class="Ln">            <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="vg">piecewise_construct</span><span class="p">,</span></span>
<span id="140L" class="Ln">            <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">forward_as_tuple</span><span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">move</span><span class="p">(</span><a href="#123L" class="nv">fuid</a><span class="p">)</span><span class="p">)</span><span class="p">,</span></span>
<span id="141L" class="Ln">            <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">forward_as_tuple</span><span class="p">(</span><span class="p">)</span><span class="p">)</span></span>
<span id="142L" class="Ln">        <span class="p">.</span><span class="vi">first</span><span class="p">-></span><span class="vi">second</span><span class="p">;</span></span>
<span id="143L" class="Ln">    <a href="#138L" class="nv">e</a><span class="p">.</span><a href="MultiTuProcessor.hpp.html#synth::FileEntry::hlFile" class="vi">hlFile</a><span class="p">.</span><a href="output.hpp.html#synth::HighlightedFile::fname" class="vi">fname</a> <span class="p">=</span> <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">move</span><span class="p">(</span><a href="#131L" class="nv">fname</a><span class="p">)</span><span class="p">;</span></span>
<span id="144L" class="Ln">    <a href="#138L" class="nv">e</a><span class="p">.</span><a href="MultiTuProcessor.hpp.html#synth::FileEntry::hlFile" class="vi">hlFile</a><span class="p">.</span><a href="output.hpp.html#synth::HighlightedFile::inOutDir" class="vi">inOutDir</a> <span class="o">=</span> <a href="#134L" class="nv">mapping</a><span class="p">;</span></span>
<span id="145L" class="Ln">    <span class="k">return</span> <span class="o">&amp;</span><a href="#138L" class="nv">e</a><span class="p">;</span></span>
<span id="146L" class="Ln"><span class="p">}</span></span>
<span id="147L" class="Ln"></span>
<span id="148L" class="Ln"><span class="kt">void</span> <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor" class="nc">MultiTuProcessor</a><span class="p">::</span><span class="def decl nf" id="synth::MultiTuProcessor::writeOutput:const-synth::SimpleTemplate&amp;">writeOutput</span><span class="p">(</span><a href="SimpleTemplate.hpp.html#synth::SimpleTemplate" class="nc">SimpleTemplate</a> <span class="kd">const</span><span class="p">&amp;</span> <span class="def decl nv">tpl</span><span class="p">)</span></span>
<span id="149L" class="Ln"><span class="p">{</span></span>
<span id="150L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::m_dirs" class="vi">m_dirs</a><span class="p">.</span><span class="nf">empty</span><span class="p">(</span><span class="p">)</span><span class="p">)</span></span>
<span id="151L" class="Ln">        <span class="k">return</span><span class="p">;</span></span>
<span id="152L" class="Ln">    <span class="kd">auto</span> <span class="def decl nv">it</span> <span class="p">=</span> <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::m_dirs" class="vi">m_dirs</a><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="p">)</span><span class="p">;</span></span>
<span id="153L" class="Ln">    <a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nc">path</span> <span class="def decl nv">rootOutDir</span> <span class="p">=</span> <a href="#152L" class="nv">it</a><span class="p">-></span><span class="vi">second</span><span class="p">;</span></span>
<span id="154L" class="Ln">    <span class="k">for</span> <span class="p">(</span><span class="p">++</span><a href="#152L" class="nv">it</a><span class="p">;</span> <a href="#152L" class="nv">it</a> <span class="p">!=</span> <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::m_dirs" class="vi">m_dirs</a><span class="p">.</span><span class="nf">end</span><span class="p">(</span><span class="p">)</span><span class="p">;</span> <span class="p">++</span><a href="#152L" class="nv">it</a><span class="p">)</span></span>
<span id="155L" class="Ln">        <a href="#153L" class="nv">rootOutDir</a> <span class="p">=</span> <a href="#commonPrefix:const-fs::path&amp;,const-fs::path&amp;" class="nf">commonPrefix</a><span class="p">(</span><a href="#153L" class="nv">rootOutDir</a><span class="p">,</span> <a href="#152L" class="nv">it</a><span class="p">-></span><span class="vi">second</span><span class="p">)</span><span class="p">;</span></span>
<span id="156L" class="Ln">    <span class="kt">bool</span> <span class="def decl nv">commonRoot</span> <span class="p">=</span> <span class="o">!</span><a href="#153L" class="nv">rootOutDir</a><span class="p">.</span><span class="nf">empty</span><span class="p">(</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <a href="#isPathSuffix:const-fs::path&amp;,const-fs::path&amp;" class="nf">isPathSuffix</a><span class="p">(</span></span>
<span id="157L" class="Ln">        <a href="#normalAbsolute:const-fs::path&amp;" class="nf">normalAbsolute</a><span class="p">(</span><a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nf">current_path</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">,</span> <a href="#153L" class="nv">rootOutDir</a><span class="p">)</span><span class="p">;</span></span>
<span id="158L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="#156L" class="nv">commonRoot</a> <span class="o">&amp;&amp;</span> <a href="#153L" class="nv">rootOutDir</a><span class="p">.</span><span class="nf">empty</span><span class="p">(</span><span class="p">)</span><span class="p">)</span></span>
<span id="159L" class="Ln">        <a href="#153L" class="nv">rootOutDir</a> <span class="p">=</span> <span class="s">"."</span><span class="p">;</span></span>
<span id="160L" class="Ln">    <a href="SimpleTemplate.hpp.html#synth::SimpleTemplate" class="nc">SimpleTemplate</a><span class="p">::</span><a href="SimpleTemplate.hpp.html#synth::SimpleTemplate::Context" class="nc">Context</a> <span class="def decl nv">ctx</span><span class="p">;</span></span>
<span id="161L" class="Ln">    <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">clog</a> <span class="p">&lt;&lt;</span> <span class="s">"Writing "</span> <span class="p">&lt;&lt;</span> <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::m_processedFiles" class="vi">m_processedFiles</a><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="p">)</span> <span class="p">&lt;&lt;</span> <span class="s">" HTML files...\n"</span><span class="p">;</span></span>
<span id="162L" class="Ln">    <span class="k">for</span> <span class="p">(</span><span class="kd">auto</span><span class="p">&amp;</span> <span class="def decl nv">fentry</span> <a href="#162L" class="p">:</a> <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::m_processedFiles" class="vi">m_processedFiles</a><span class="p">)</span> <span class="p">{</span></span>
<span id="163L" class="Ln">        <span class="kd">auto</span><span class="p">&amp;</span> <span class="def decl nv">hlFile</span> <span class="p">=</span> <a href="#162L" class="nv">fentry</a><span class="p">.</span><span class="vi">second</span><span class="p">.</span><a href="MultiTuProcessor.hpp.html#synth::FileEntry::hlFile" class="vi">hlFile</a><span class="p">;</span></span>
<span id="164L" class="Ln">        <span class="kd">auto</span> <span class="def decl nv">dstPath</span> <span class="p">=</span> <a href="#163L" class="nv">hlFile</a><span class="p">.</span><a href="output.hpp.html#synth::HighlightedFile::dstPath" class="nf">dstPath</a><span class="p">(</span><span class="p">)</span><span class="p">;</span></span>
<span id="165L" class="Ln">        <span class="kd">auto</span> <span class="def decl nv">hldir</span> <span class="p">=</span> <a href="#164L" class="nv">dstPath</a><span class="p">.</span><span class="nf">parent_path</span><span class="p">(</span><span class="p">)</span><span class="p">;</span></span>
<span id="166L" class="Ln">        <span class="k">if</span> <span class="p">(</span><a href="#165L" class="nv">hldir</a> <span class="p">!=</span> <span class="s">"."</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><a href="#165L" class="nv">hldir</a><span class="p">.</span><span class="nf">empty</span><span class="p">(</span><span class="p">)</span><span class="p">)</span></span>
<span id="167L" class="Ln">            <a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nf">create_directories</span><span class="p">(</span><a href="#165L" class="nv">hldir</a><span class="p">)</span><span class="p">;</span></span>
<span id="168L" class="Ln">        <a href="output.hpp.html#synth::sortMarkups:std::vector<Markup>&amp;" class="nf">sortMarkups</a><span class="p">(</span><a href="#163L" class="nv">hlFile</a><span class="p">.</span><a href="output.hpp.html#synth::HighlightedFile::markups" class="vi">markups</a><span class="p">)</span><span class="p">;</span></span>
<span id="169L" class="Ln">        <a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nc">ifstream</span> <span class="def decl nv">srcfile</span><span class="p">(</span><a href="#163L" class="nv">hlFile</a><span class="p">.</span><a href="output.hpp.html#synth::HighlightedFile::srcPath" class="nf">srcPath</a><span class="p">(</span><span class="p">)</span><span class="p">,</span> <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nc">ios</span><span class="p">::</span><span class="vc">binary</span><span class="p">)</span><span class="p">;</span></span>
<span id="170L" class="Ln">        <a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nc">ofstream</span> <span class="def decl nv">outfile</span><span class="p">;</span></span>
<span id="171L" class="Ln">        <span class="k">try</span> <span class="p">{</span></span>
<span id="172L" class="Ln">            <a href="#169L" class="nv">srcfile</a><span class="p">.</span><span class="nf">exceptions</span><span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nc">ios</span><span class="p">::</span><span class="vc">badbit</span><span class="p">)</span><span class="p">;</span></span>
<span id="173L" class="Ln">            <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/container/vector" class="nc">vector</a><span class="p">&lt;</span><a href="output.hpp.html#synth::Markup" class="nc">Markup</a><span class="p">></span> <span class="def decl nv">suppMarkups</span><span class="p">;</span></span>
<span id="174L" class="Ln">            <a href="basicHl.hpp.html#synth::basicHighlightFile:std::istream&amp;,std::vector<Markup>&amp;" class="nf">basicHighlightFile</a><span class="p">(</span><a href="#169L" class="nv">srcfile</a><span class="p">,</span> <a href="#173L" class="nv">suppMarkups</a><span class="p">)</span><span class="p">;</span></span>
<span id="175L" class="Ln">            <a href="output.hpp.html#synth::sortMarkups:std::vector<Markup>&amp;" class="nf">sortMarkups</a><span class="p">(</span><a href="#173L" class="nv">suppMarkups</a><span class="p">)</span><span class="p">;</span></span>
<span id="176L" class="Ln">            <a href="#163L" class="nv">hlFile</a><span class="p">.</span><a href="output.hpp.html#synth::HighlightedFile::supplementMarkups:const-std::vector<Markup>&amp;" class="nf">supplementMarkups</a><span class="p">(</span><a href="#173L" class="nv">suppMarkups</a><span class="p">)</span><span class="p">;</span></span>
<span id="177L" class="Ln">            <a href="#169L" class="nv">srcfile</a><span class="p">.</span><span class="nf">clear</span><span class="p">(</span><span class="p">)</span><span class="p">;</span></span>
<span id="178L" class="Ln">            <a href="#169L" class="nv">srcfile</a><span class="p">.</span><span class="nf">seekg</span><span class="p">(</span><span class="m">0</span><span class="p">)</span><span class="p">;</span></span>
<span id="179L" class="Ln">            <a href="#170L" class="nv">outfile</a><span class="p">.</span><span class="nf">open</span><span class="p">(</span><a href="#164L" class="nv">dstPath</a><span class="p">,</span> <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nc">ios</span><span class="p">::</span><span class="vc">binary</span><span class="p">)</span><span class="p">;</span></span>
<span id="180L" class="Ln">            <a href="#170L" class="nv">outfile</a><span class="p">.</span><span class="nf">exceptions</span><span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nc">ios</span><span class="p">::</span><span class="vc">badbit</span> <span class="p">|</span> <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nc">ios</span><span class="p">::</span><span class="vc">failbit</span><span class="p">)</span><span class="p">;</span></span>
<span id="181L" class="Ln">            <a href="#160L" class="nv">ctx</a><span class="p">[</span><span class="s">"code"</span><span class="p">]</span> <span class="p">=</span> <a href="SimpleTemplate.hpp.html#synth::SimpleTemplate" class="nc">SimpleTemplate</a><span class="p">::</span><a href="SimpleTemplate.hpp.html#synth::SimpleTemplate::ValCallback" class="nc">ValCallback</a><span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">bind</span><span class="p">(</span></span>
<span id="182L" class="Ln">                <span class="o">&amp;</span><a href="output.hpp.html#synth::HighlightedFile" class="nc">HighlightedFile</a><span class="p">::</span><a href="output.hpp.html#synth::HighlightedFile::writeTo:std::ostream&amp;,synth::MultiTuProcessor&amp;,std::ifstream&amp;" class="nf">writeTo</a><span class="p">,</span></span>
<span id="183L" class="Ln">                <span class="o">&amp;</span><a href="#163L" class="nv">hlFile</a><span class="p">,</span></span>
<span id="184L" class="Ln">                <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/utility/functional/placeholders" class="nn">placeholders</a><span class="p">::</span><span class="vg">_1</span><span class="p">,</span></span>
<span id="185L" class="Ln">                <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">ref</span><span class="p">(</span><span class="o">*</span><span class="kc">this</span><span class="p">)</span><span class="p">,</span></span>
<span id="186L" class="Ln">                <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">ref</span><span class="p">(</span><a href="#169L" class="nv">srcfile</a><span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="187L" class="Ln">            <a href="#160L" class="nv">ctx</a><span class="p">[</span><span class="s">"filename"</span><span class="p">]</span> <span class="p">=</span> <a href="#163L" class="nv">hlFile</a><span class="p">.</span><a href="output.hpp.html#synth::HighlightedFile::fname" class="vi">fname</a><span class="p">.</span><span class="nf">string</span><span class="p">(</span><span class="p">)</span><span class="p">;</span></span>
<span id="188L" class="Ln">            <a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nc">path</span> <span class="def decl nv">rootpath</span> <span class="p">=</span> <a href="MultiTuProcessor.hpp.html#21L" class="nn">fs</a><span class="p">::</span><span class="nf">relative</span><span class="p">(</span></span>
<span id="189L" class="Ln">                    <a href="#156L" class="nv">commonRoot</a> <span class="p">?</span> <a href="#153L" class="nv">rootOutDir</a> <span class="p">:</span> <a href="#163L" class="nv">hlFile</a><span class="p">.</span><a href="output.hpp.html#synth::HighlightedFile::inOutDir" class="vi">inOutDir</a><span class="p">-></span><span class="vi">second</span><span class="p">,</span> <a href="#165L" class="nv">hldir</a><span class="p">)</span></span>
<span id="190L" class="Ln">                <span class="p">.</span><span class="nf">lexically_normal</span><span class="p">(</span><span class="p">)</span><span class="p">;</span></span>
<span id="191L" class="Ln">            <a href="#160L" class="nv">ctx</a><span class="p">[</span><span class="s">"rootpath"</span><span class="p">]</span> <span class="p">=</span> <a href="#188L" class="nv">rootpath</a><span class="p">.</span><span class="nf">empty</span><span class="p">(</span><span class="p">)</span> <span class="p">?</span> <span class="s">"."</span> <span class="p">:</span> <a href="#188L" class="nv">rootpath</a><span class="p">.</span><span class="nf">string</span><span class="p">(</span><span class="p">)</span><span class="p">;</span></span>
<span id="192L" class="Ln">            <a href="#148L" class="nv">tpl</a><span class="p">.</span><a href="SimpleTemplate.hpp.html#synth::SimpleTemplate::writeTo:std::ostream&amp;,const-Context&amp;" class="nf">writeTo</a><span class="p">(</span><a href="#170L" class="nv">outfile</a><span class="p">,</span> <a href="#160L" class="nv">ctx</a><span class="p">)</span><span class="p">;</span></span>
<span id="193L" class="Ln">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nc">ios</span><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/ios_base/failure" class="nc">failure</a> <span class="kd">const</span><span class="p">&amp;</span> <span class="def decl nv">e</span><span class="p">)</span> <span class="p">{</span></span>
<span id="194L" class="Ln">            <span class="k">if</span> <span class="p">(</span><span class="p">!</span><a href="#169L" class="nv">srcfile</a><span class="p">)</span> <span class="p">{</span></span>
<span id="195L" class="Ln">                <span class="k">throw</span> <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/error/runtime_error" class="nc">runtime_error</a><span class="p">(</span></span>
<span id="196L" class="Ln">                    <span class="s">"Error reading from or opening "</span></span>
<span id="197L" class="Ln">                    <span class="p">+</span> <a href="#163L" class="nv">hlFile</a><span class="p">.</span><a href="output.hpp.html#synth::HighlightedFile::srcPath" class="nf">srcPath</a><span class="p">(</span><span class="p">)</span><span class="p">.</span><span class="nf">string</span><span class="p">(</span><span class="p">)</span></span>
<span id="198L" class="Ln">                    <span class="p">+</span> <span class="s">": "</span> <span class="p">+</span> <a href="#193L" class="nv">e</a><span class="p">.</span><a href="http://en.cppreference.com/w/cpp/error/exception/what" class="nf">what</a><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="199L" class="Ln">            <span class="p">}</span></span>
<span id="200L" class="Ln">            <span class="k">if</span> <span class="p">(</span><span class="p">!</span><a href="#170L" class="nv">outfile</a><span class="p">)</span> <span class="p">{</span></span>
<span id="201L" class="Ln">                <span class="k">throw</span> <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/error/runtime_error" class="nc">runtime_error</a><span class="p">(</span></span>
<span id="202L" class="Ln">                    <span class="s">"Error writing to or opening "</span></span>
<span id="203L" class="Ln">                    <span class="p">+</span> <a href="#163L" class="nv">hlFile</a><span class="p">.</span><a href="output.hpp.html#synth::HighlightedFile::dstPath" class="nf">dstPath</a><span class="p">(</span><span class="p">)</span><span class="p">.</span><span class="nf">string</span><span class="p">(</span><span class="p">)</span></span>
<span id="204L" class="Ln">                    <span class="p">+</span> <span class="s">": "</span> <span class="p">+</span> <a href="#193L" class="nv">e</a><span class="p">.</span><a href="http://en.cppreference.com/w/cpp/error/exception/what" class="nf">what</a><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="205L" class="Ln">            <span class="p">}</span></span>
<span id="206L" class="Ln">            <span class="cp">assert</span>(<span class="s">"ios::failure but no file with badbit or failbit"</span> <span class="p">&amp;&amp;</span> <span class="kc">false</span>)<span class="p">;</span></span>
<span id="207L" class="Ln">            <span class="k">throw</span><span class="p">;</span></span>
<span id="208L" class="Ln">        <span class="p">}</span></span>
<span id="209L" class="Ln">    <span class="p">}</span></span>
<span id="210L" class="Ln"><span class="p">}</span></span>
<span id="211L" class="Ln"></span>
<span id="212L" class="Ln"></span>
</pre></div>
        <script src="../code.js"></script>
    </body>
</html>
