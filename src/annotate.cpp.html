<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>src/annotate.cpp</title>
        <link rel="stylesheet" href="../codestyle-colorful.css">
    </head>
    <body>
        <div class="highlight"><pre><span id="1L" class="Ln"><a href="annotate.hpp.html"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">"annotate.hpp"</span></a></span>
<span id="2L" class="Ln"></span>
<span id="3L" class="Ln"><a href="CgStr.hpp.html"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">"CgStr.hpp"</span></a></span>
<span id="4L" class="Ln"><a href="MultiTuProcessor.hpp.html"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">"MultiTuProcessor.hpp"</span></a></span>
<span id="5L" class="Ln"><a href="cgWrappers.hpp.html"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">"cgWrappers.hpp"</span></a></span>
<span id="6L" class="Ln"><a href="FileIdSupport.hpp.html"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">"FileIdSupport.hpp"</span></a></span>
<span id="7L" class="Ln"><a href="highlight.hpp.html"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">"highlight.hpp"</span></a></span>
<span id="8L" class="Ln"><a href="output.hpp.html"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">"output.hpp"</span></a></span>
<span id="9L" class="Ln"><a href="xref.hpp.html"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">"xref.hpp"</span></a></span>
<span id="10L" class="Ln"></span>
<span id="11L" class="Ln"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">&lt;</span><span class="cpf">boost</span><span class="cpf">/</span><span class="cpf">assert</span><span class="cpf">.</span><span class="cpf">hpp</span><span class="cpf">></span></span>
<span id="12L" class="Ln"></span>
<span id="13L" class="Ln"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">&lt;</span><span class="cpf">climits</span><span class="cpf">></span></span>
<span id="14L" class="Ln"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">&lt;</span><span class="cpf">iostream</span><span class="cpf">></span></span>
<span id="15L" class="Ln"></span>
<span id="16L" class="Ln"><span class="kd">using</span> <span class="kd">namespace</span> <a href="annotate.hpp.html#synth" class="nn">synth</a>;</span>
<span id="17L" class="Ln"></span>
<span id="18L" class="Ln"><span class="c">// This is needed for macro arguments: clang_equalLocations is only true if two</span></span>
<span id="19L" class="Ln"><span class="c">// locations are truly equal. That is if either of spelling-, source- or</span></span>
<span id="20L" class="Ln"><span class="c">// file-location is different, it returns false. However we are only interested</span></span>
<span id="21L" class="Ln"><span class="c">// in the file location, hence this function.</span></span>
<span id="22L" class="Ln"><span class="c">// We must work with the offset here because it is in fact often different (and</span></span>
<span id="23L" class="Ln"><span class="c">// more "correct" for our purposes) from what line:column would suggest. See</span></span>
<span id="24L" class="Ln"><span class="c">// also comment inside processToken().</span></span>
<span id="25L" class="Ln"><span class="kd">static</span> <span class="kt">bool</span> <span class="def decl nf" id="equalFileLocations:CXSourceLocation,CXSourceLocation">equalFileLocations</span><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#367L" class="nc">CXSourceLocation</a> <span class="def decl nv">loc1</span><span class="p">,</span> <a href="../lib-llvm/include/clang-c/Index.h.html#367L" class="nc">CXSourceLocation</a> <span class="def decl nv">loc2</span><span class="p">)</span></span>
<span id="26L" class="Ln"><span class="p">{</span></span>
<span id="27L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#CXFile" class="nc">CXFile</a> <span class="def decl nv">f1</span><span class="p">;</span></span>
<span id="28L" class="Ln">    <span class="kt">unsigned</span> <span class="def decl nv">off1</span><span class="p">;</span></span>
<span id="29L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getFileLocation:CXSourceLocation,CXFile*,unsigned-int*,unsigned-int*,unsigned-int*" class="nf">clang_getFileLocation</a><span class="p">(</span><a href="#25L" class="nv">loc1</a><span class="p">,</span> <span class="o">&amp;</span><a href="#27L" class="nv">f1</a><span class="p">,</span> <span class="kc">nullptr</span><span class="p">,</span> <span class="kc">nullptr</span><span class="p">,</span> <span class="o">&amp;</span><a href="#28L" class="nv">off1</a><span class="p">)</span><span class="p">;</span></span>
<span id="30L" class="Ln"></span>
<span id="31L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#CXFile" class="nc">CXFile</a> <span class="def decl nv">f2</span><span class="p">;</span></span>
<span id="32L" class="Ln">    <span class="kt">unsigned</span> <span class="def decl nv">off2</span><span class="p">;</span></span>
<span id="33L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getFileLocation:CXSourceLocation,CXFile*,unsigned-int*,unsigned-int*,unsigned-int*" class="nf">clang_getFileLocation</a><span class="p">(</span><a href="#25L" class="nv">loc2</a><span class="p">,</span> <span class="o">&amp;</span><a href="#31L" class="nv">f2</a><span class="p">,</span> <span class="kc">nullptr</span><span class="p">,</span> <span class="kc">nullptr</span><span class="p">,</span> <span class="o">&amp;</span><a href="#32L" class="nv">off2</a><span class="p">)</span><span class="p">;</span></span>
<span id="34L" class="Ln"></span>
<span id="35L" class="Ln">    <span class="k">return</span> <a href="#28L" class="nv">off1</a> <span class="o">==</span> <a href="#32L" class="nv">off2</a> <span class="o">&amp;&amp;</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_File_isEqual:CXFile,CXFile" class="nf">clang_File_isEqual</a><span class="p">(</span><a href="#27L" class="nv">f1</a><span class="p">,</span> <a href="#31L" class="nv">f2</a><span class="p">)</span><span class="p">;</span></span>
<span id="36L" class="Ln"><span class="p">}</span></span>
<span id="37L" class="Ln"></span>
<span id="38L" class="Ln"><span class="kd">static</span> <span class="kt">unsigned</span> <span class="def decl nf" id="getLocOffset:CXSourceLocation">getLocOffset</span><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#367L" class="nc">CXSourceLocation</a> <span class="def decl nv">loc</span><span class="p">)</span></span>
<span id="39L" class="Ln"><span class="p">{</span></span>
<span id="40L" class="Ln">    <span class="kt">unsigned</span> <span class="def decl nv">r</span><span class="p">;</span></span>
<span id="41L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getFileLocation:CXSourceLocation,CXFile*,unsigned-int*,unsigned-int*,unsigned-int*" class="nf">clang_getFileLocation</a><span class="p">(</span><a href="#38L" class="nv">loc</a><span class="p">,</span> <span class="kc">nullptr</span><span class="p">,</span> <span class="kc">nullptr</span><span class="p">,</span> <span class="kc">nullptr</span><span class="p">,</span> <span class="o">&amp;</span><a href="#40L" class="nv">r</a><span class="p">)</span><span class="p">;</span></span>
<span id="42L" class="Ln">    <span class="k">return</span> <a href="#40L" class="nv">r</a><span class="p">;</span></span>
<span id="43L" class="Ln"><span class="p">}</span></span>
<span id="44L" class="Ln"></span>
<span id="45L" class="Ln"><span class="kd">namespace</span> <span class="p">{</span></span>
<span id="46L" class="Ln"></span>
<span id="47L" class="Ln"><span class="kd">struct</span> <span class="def decl nc" id="FileAnnotationState">FileAnnotationState</span> <span class="p">{</span></span>
<span id="48L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#CXFile" class="nc">CXFile</a> <span class="def decl vi" id="FileAnnotationState::file">file</span><span class="p">;</span></span>
<span id="49L" class="Ln">    <a href="output.hpp.html#synth::HighlightedFile" class="nc">HighlightedFile</a><span class="p">&amp;</span> <span class="def decl vi" id="FileAnnotationState::hlFile">hlFile</span><span class="p">;</span></span>
<span id="50L" class="Ln">    <a href="cgWrappers.hpp.html#synth::CgTokensHandle" class="nc">CgTokensHandle</a> <span class="def decl vi" id="FileAnnotationState::tokens">tokens</span><span class="p">;</span></span>
<span id="51L" class="Ln">    <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/container/vector" class="nc">vector</a><span class="p">&lt;</span><a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="nc">CXCursor</a><span class="p">></span> <span class="def decl vi" id="FileAnnotationState::annotations">annotations</span><span class="p">;</span></span>
<span id="52L" class="Ln">    <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/container/vector" class="nc">vector</a><span class="p">&lt;</span><span class="kt">bool</span><span class="p">></span> <span class="def decl vi" id="FileAnnotationState::annotationBad">annotationBad</span><span class="p">;</span></span>
<span id="53L" class="Ln"></span>
<span id="54L" class="Ln">    <span class="c">// Maps from token begin offsets to indices (in tokens and tokCurs).</span></span>
<span id="55L" class="Ln">    <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/container/unordered_map" class="nc">unordered_map</a><span class="p">&lt;</span><span class="kt">unsigned</span><span class="p">,</span> <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/types/size_t" class="nc">size_t</a><span class="p">></span> <span class="def decl vi" id="FileAnnotationState::locationMap">locationMap</span><span class="p">;</span></span>
<span id="56L" class="Ln"></span>
<span id="57L" class="Ln">    <span class="kt">void</span> <span class="def decl nf" id="FileAnnotationState::populateLocationMap:CXTranslationUnit">populateLocationMap</span><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#CXTranslationUnit" class="nc">CXTranslationUnit</a> <span class="def decl nv">tu</span><span class="p">)</span></span>
<span id="58L" class="Ln">    <span class="p">{</span></span>
<span id="59L" class="Ln">        <span class="k">for</span> <span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/types/size_t" class="nc">size_t</a> <span class="def decl nv">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <a href="#59L" class="nv">i</a> <span class="o">&lt;</span> <a href="#FileAnnotationState::tokens" class="vi">tokens</a><span class="p">.</span><a href="cgWrappers.hpp.html#synth::CgTokensHandle::size" class="nf">size</a><span class="p">(</span><span class="p">)</span><span class="p">;</span> <span class="o">++</span><a href="#59L" class="nv">i</a><span class="p">)</span> <span class="p">{</span></span>
<span id="60L" class="Ln">            <a href="../lib-llvm/include/clang-c/Index.h.html#4250L" class="nc">CXToken</a> <span class="def decl nv">tok</span> <span class="p">=</span> <a href="#FileAnnotationState::tokens" class="vi">tokens</a><span class="p">.</span><a href="cgWrappers.hpp.html#synth::CgTokensHandle::tokens" class="nf">tokens</a><span class="p">(</span><span class="p">)</span><span class="p">[</span><a href="#59L" class="nv">i</a><span class="p">]</span><span class="p">;</span></span>
<span id="61L" class="Ln">            <span class="kt">unsigned</span> <span class="def decl nv">off</span> <span class="p">=</span> <a href="#getLocOffset:CXSourceLocation" class="nf">getLocOffset</a><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_getTokenLocation:CXTranslationUnit,CXToken" class="nf">clang_getTokenLocation</a><span class="p">(</span><a href="#57L" class="nv">tu</a><span class="p">,</span> <a href="#60L" class="nv">tok</a><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="62L" class="Ln">            <span class="cp">BOOST_VERIFY</span>(<a href="#FileAnnotationState::locationMap" class="vi">locationMap</a><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="p">{</span><a href="#61L" class="nv">off</a><span class="p">,</span> <a href="#59L" class="nv">i</a><span class="p">}</span><span class="p">)</span><span class="p">.</span><span class="vi">second</span>)<span class="p">;</span></span>
<span id="63L" class="Ln">        <span class="p">}</span></span>
<span id="64L" class="Ln">    <span class="p">}</span></span>
<span id="65L" class="Ln"><span class="p">}</span><span class="p">;</span></span>
<span id="66L" class="Ln"></span>
<span id="67L" class="Ln"><span class="kd">using</span> <span class="def decl nc" id="TuAnnotationMap">TuAnnotationMap</span> <span class="p">=</span> <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/container/unordered_map" class="nc">unordered_map</a><span class="p">&lt;</span><a href="../lib-llvm/include/clang-c/Index.h.html#302L" class="nc">CXFileUniqueID</a><span class="p">,</span> <a href="#FileAnnotationState" class="nc">FileAnnotationState</a><span class="p">></span><span class="p">;</span></span>
<span id="68L" class="Ln"></span>
<span id="69L" class="Ln"><span class="kd">struct</span> <span class="def decl nc" id="TuState">TuState</span> <span class="p">{</span></span>
<span id="70L" class="Ln">    <a href="#TuAnnotationMap" class="nc">TuAnnotationMap</a> <span class="def decl vi" id="TuState::annotationMap">annotationMap</span><span class="p">;</span></span>
<span id="71L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#CXTranslationUnit" class="nc">CXTranslationUnit</a> <span class="def decl vi" id="TuState::tu">tu</span><span class="p">;</span></span>
<span id="72L" class="Ln">    <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor" class="nc">MultiTuProcessor</a><span class="p">&amp;</span> <span class="def decl vi" id="TuState::multiTuProcessor">multiTuProcessor</span><span class="p">;</span></span>
<span id="73L" class="Ln">    <span class="kt">bool</span> <span class="def decl vi" id="TuState::isC">isC</span><span class="p">;</span></span>
<span id="74L" class="Ln"><span class="p">}</span><span class="p">;</span></span>
<span id="75L" class="Ln"></span>
<span id="76L" class="Ln"><span class="kd">struct</span> <span class="def decl nc" id="FileState">FileState</span> <span class="p">{</span></span>
<span id="77L" class="Ln">    <a href="#TuState" class="nc">TuState</a><span class="p">&amp;</span> <span class="def decl vi" id="FileState::tuState">tuState</span><span class="p">;</span></span>
<span id="78L" class="Ln">    <a href="output.hpp.html#synth::HighlightedFile" class="nc">HighlightedFile</a><span class="p">&amp;</span> <span class="def decl vi" id="FileState::hlFile">hlFile</span><span class="p">;</span></span>
<span id="79L" class="Ln">    <span class="kt">bool</span> <span class="def decl vi" id="FileState::lnkPending">lnkPending</span><span class="p">;</span></span>
<span id="80L" class="Ln"><span class="p">}</span><span class="p">;</span></span>
<span id="81L" class="Ln"></span>
<span id="82L" class="Ln"><span class="p">}</span> <span class="c">// anonymous namespace</span></span>
<span id="83L" class="Ln"></span>
<span id="84L" class="Ln"><span class="kd">static</span> <a href="#FileAnnotationState" class="nc">FileAnnotationState</a><span class="p">*</span> <span class="def decl nf" id="lookupFileAnnotations:TuAnnotationMap&amp;,CXFile">lookupFileAnnotations</span><span class="p">(</span><a href="#TuAnnotationMap" class="nc">TuAnnotationMap</a><span class="p">&amp;</span> <span class="def decl nv">m</span><span class="p">,</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXFile" class="nc">CXFile</a> <span class="def decl nv">f</span><span class="p">)</span></span>
<span id="85L" class="Ln"><span class="p">{</span></span>
<span id="86L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#302L" class="nc">CXFileUniqueID</a> <span class="def decl nv">fuid</span><span class="p">;</span></span>
<span id="87L" class="Ln">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><a href="#84L" class="nv">f</a> <span class="o">||</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getFileUniqueID:CXFile,CXFileUniqueID*" class="nf">clang_getFileUniqueID</a><span class="p">(</span><a href="#84L" class="nv">f</a><span class="p">,</span> <span class="o">&amp;</span><a href="#86L" class="nv">fuid</a><span class="p">)</span> <span class="o">!=</span> <span class="m">0</span><span class="p">)</span></span>
<span id="88L" class="Ln">        <span class="k">return</span> <span class="kc">nullptr</span><span class="p">;</span></span>
<span id="89L" class="Ln">    <span class="kd">auto</span> <span class="def decl nv">it</span> <span class="p">=</span> <a href="#84L" class="nv">m</a><span class="p">.</span><span class="nf">find</span><span class="p">(</span><a href="#86L" class="nv">fuid</a><span class="p">)</span><span class="p">;</span></span>
<span id="90L" class="Ln">    <span class="k">return</span> <a href="#89L" class="nv">it</a> <span class="p">==</span> <a href="#84L" class="nv">m</a><span class="p">.</span><span class="nf">end</span><span class="p">(</span><span class="p">)</span> <span class="p">?</span> <span class="kc">nullptr</span> <span class="p">:</span> <span class="o">&amp;</span><a href="#89L" class="nv">it</a><span class="p">-></span><span class="vi">second</span><span class="p">;</span></span>
<span id="91L" class="Ln"><span class="p">}</span></span>
<span id="92L" class="Ln"></span>
<span id="93L" class="Ln"><span class="kd">static</span> <span class="kt">void</span> <span class="def decl nf" id="processToken:(anonymous-namespace)::FileState&amp;,CXToken,CXCursor">processToken</span><span class="p">(</span><a href="#FileState" class="nc">FileState</a><span class="p">&amp;</span> <span class="def decl nv">state</span><span class="p">,</span> <a href="../lib-llvm/include/clang-c/Index.h.html#4250L" class="nc">CXToken</a> <span class="def decl nv">tok</span><span class="p">,</span> <a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="nc">CXCursor</a> <span class="def decl nv">cur</span><span class="p">)</span></span>
<span id="94L" class="Ln"><span class="p">{</span></span>
<span id="95L" class="Ln">    <span class="kd">auto</span><span class="p">&amp;</span> <span class="def decl nv">markups</span> <span class="p">=</span> <a href="#93L" class="nv">state</a><span class="p">.</span><a href="#FileState::hlFile" class="vi">hlFile</a><span class="p">.</span><a href="output.hpp.html#synth::HighlightedFile::markups" class="vi">markups</a><span class="p">;</span></span>
<span id="96L" class="Ln">    <a href="#95L" class="nv">markups</a><span class="p">.</span><span class="nf">emplace_back</span><span class="p">(</span><span class="p">)</span><span class="p">;</span></span>
<span id="97L" class="Ln">    <a href="output.hpp.html#synth::Markup" class="nc">Markup</a><span class="p">*</span> <span class="def decl nv">m</span> <span class="p">=</span> <span class="o">&amp;</span><a href="#95L" class="nv">markups</a><span class="p">.</span><span class="nf">back</span><span class="p">(</span><span class="p">)</span><span class="p">;</span></span>
<span id="98L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#CXTranslationUnit" class="nc">CXTranslationUnit</a> <span class="def decl nv">tu</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_Cursor_getTranslationUnit:CXCursor" class="nf">clang_Cursor_getTranslationUnit</a><span class="p">(</span><a href="#93L" class="nv">cur</a><span class="p">)</span><span class="p">;</span></span>
<span id="99L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#378L" class="nc">CXSourceRange</a> <span class="def decl nv">rng</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getTokenExtent:CXTranslationUnit,CXToken" class="nf">clang_getTokenExtent</a><span class="p">(</span><a href="#98L" class="nv">tu</a><span class="p">,</span> <a href="#93L" class="nv">tok</a><span class="p">)</span><span class="p">;</span></span>
<span id="100L" class="Ln">    <span class="kt">unsigned</span> <span class="def decl nv">lineno</span><span class="p">;</span></span>
<span id="101L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getFileLocation:CXSourceLocation,CXFile*,unsigned-int*,unsigned-int*,unsigned-int*" class="nf">clang_getFileLocation</a><span class="p">(</span></span>
<span id="102L" class="Ln">        <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getRangeStart:CXSourceRange" class="nf">clang_getRangeStart</a><span class="p">(</span><a href="#99L" class="nv">rng</a><span class="p">)</span><span class="p">,</span> <span class="kc">nullptr</span><span class="p">,</span> <span class="o">&amp;</span><a href="#100L" class="nv">lineno</a><span class="p">,</span> <span class="kc">nullptr</span><span class="p">,</span> <span class="o">&amp;</span><a href="#97L" class="nv">m</a><span class="p">-></span><a href="output.hpp.html#synth::Markup::beginOffset" class="vi">beginOffset</a><span class="p">)</span><span class="p">;</span></span>
<span id="103L" class="Ln">    <a href="#97L" class="nv">m</a><span class="p">-></span><a href="output.hpp.html#synth::Markup::endOffset" class="vi">endOffset</a> <span class="o">=</span> <a href="#getLocOffset:CXSourceLocation" class="nf">getLocOffset</a><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_getRangeEnd:CXSourceRange" class="nf">clang_getRangeEnd</a><span class="p">(</span><a href="#99L" class="nv">rng</a><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="104L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="#97L" class="nv">m</a><span class="p">-></span><a href="output.hpp.html#synth::Markup::beginOffset" class="vi">beginOffset</a> <span class="o">==</span> <a href="#97L" class="nv">m</a><span class="p">-></span><a href="output.hpp.html#synth::Markup::endOffset" class="vi">endOffset</a><span class="p">)</span> <span class="p">{</span></span>
<span id="105L" class="Ln">        <a href="#95L" class="nv">markups</a><span class="p">.</span><span class="nf">pop_back</span><span class="p">(</span><span class="p">)</span><span class="p">;</span></span>
<span id="106L" class="Ln">        <span class="k">return</span><span class="p">;</span></span>
<span id="107L" class="Ln">    <span class="p">}</span></span>
<span id="108L" class="Ln"></span>
<span id="109L" class="Ln">    <a href="CgStr.hpp.html#synth::CgStr" class="nc">CgStr</a> <span class="def decl nv">hsp</span><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_getTokenSpelling:CXTranslationUnit,CXToken" class="nf">clang_getTokenSpelling</a><span class="p">(</span><a href="#98L" class="nv">tu</a><span class="p">,</span> <a href="#93L" class="nv">tok</a><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="110L" class="Ln">    <span class="nn">boost</span><span class="p">::</span><span class="nc">string_ref</span> <span class="def decl nv">sp</span> <span class="p">=</span> <a href="#109L" class="nv">hsp</a><span class="p">.</span><a href="CgStr.hpp.html#synth::CgStr::gets" class="nf">gets</a><span class="p">(</span><span class="p">)</span><span class="p">;</span></span>
<span id="111L" class="Ln">    <a href="#97L" class="nv">m</a><span class="p">-></span><a href="output.hpp.html#synth::Markup::attrs" class="vi">attrs</a> <span class="o">=</span> <a href="highlight.hpp.html#synth::getTokenAttributes:CXToken,CXCursor,boost::string_ref" class="nf">getTokenAttributes</a><span class="p">(</span><a href="#93L" class="nv">tok</a><span class="p">,</span> <a href="#93L" class="nv">cur</a><span class="p">,</span> <a href="#110L" class="nv">sp</a><span class="p">)</span><span class="p">;</span></span>
<span id="112L" class="Ln"></span>
<span id="113L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#CXTokenKind" class="nc">CXTokenKind</a> <span class="def decl nv">tk</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getTokenKind:CXToken" class="nf">clang_getTokenKind</a><span class="p">(</span><a href="#93L" class="nv">tok</a><span class="p">)</span><span class="p">;</span></span>
<span id="114L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="#113L" class="nv">tk</a> <span class="o">==</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXTokenKind::CXToken_Comment" class="no">CXToken_Comment</a> <span class="o">||</span> <a href="#113L" class="nv">tk</a> <span class="o">==</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXTokenKind::CXToken_Literal" class="no">CXToken_Literal</a><span class="p">)</span></span>
<span id="115L" class="Ln">        <span class="k">return</span><span class="p">;</span></span>
<span id="116L" class="Ln"></span>
<span id="117L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#CXCursorKind" class="nc">CXCursorKind</a> <span class="def decl nv">k</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getCursorKind:CXCursor" class="nf">clang_getCursorKind</a><span class="p">(</span><a href="#93L" class="nv">cur</a><span class="p">)</span><span class="p">;</span></span>
<span id="118L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="#93L" class="nv">state</a><span class="p">.</span><a href="#FileState::lnkPending" class="vi">lnkPending</a><span class="p">)</span> <span class="p">{</span></span>
<span id="119L" class="Ln">        <span class="k">if</span> <span class="p">(</span><a href="#113L" class="nv">tk</a> <span class="o">==</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXTokenKind::CXToken_Punctuation" class="no">CXToken_Punctuation</a> <span class="o">&amp;&amp;</span> <span class="p">(</span><a href="#110L" class="nv">sp</a> <span class="p">==</span> <span class="s">"("</span> <span class="o">||</span> <a href="#110L" class="nv">sp</a> <span class="p">==</span> <span class="s">"["</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span></span>
<span id="120L" class="Ln">            <span class="c">// This is the "("/"[" of an operator overload and we also want</span></span>
<span id="121L" class="Ln">            <span class="c">// to highlight the closing ")"/"]".</span></span>
<span id="122L" class="Ln">            <span class="k">return</span><span class="p">;</span></span>
<span id="123L" class="Ln">        <span class="p">}</span></span>
<span id="124L" class="Ln"></span>
<span id="125L" class="Ln">        <a href="#93L" class="nv">state</a><span class="p">.</span><a href="#FileState::lnkPending" class="vi">lnkPending</a> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></span>
<span id="126L" class="Ln">        <a href="output.hpp.html#synth::Markup" class="nc">Markup</a> <span class="def decl nv">lnk</span> <span class="p">=</span> <span class="p">{</span><span class="p">}</span><span class="p">;</span></span>
<span id="127L" class="Ln">        <a href="#126L" class="nv">lnk</a><span class="p">.</span><a href="output.hpp.html#synth::Markup::beginOffset" class="vi">beginOffset</a> <span class="o">=</span> <a href="#getLocOffset:CXSourceLocation" class="nf">getLocOffset</a><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_getCursorLocation:CXCursor" class="nf">clang_getCursorLocation</a><span class="p">(</span><a href="#93L" class="nv">cur</a><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="128L" class="Ln">        <a href="#126L" class="nv">lnk</a><span class="p">.</span><a href="output.hpp.html#synth::Markup::endOffset" class="vi">endOffset</a> <span class="o">=</span> <a href="#97L" class="nv">m</a><span class="p">-></span><a href="output.hpp.html#synth::Markup::endOffset" class="vi">endOffset</a><span class="p">;</span></span>
<span id="129L" class="Ln">        <span class="cp">assert</span>(<a href="#126L" class="nv">lnk</a><span class="p">.</span><a href="output.hpp.html#synth::Markup::beginOffset" class="vi">beginOffset</a> <span class="p">&lt;</span> <a href="#126L" class="nv">lnk</a><span class="p">.</span><a href="output.hpp.html#synth::Markup::endOffset" class="vi">endOffset</a>)<span class="p">;</span></span>
<span id="130L" class="Ln">        <a href="#95L" class="nv">markups</a><span class="p">.</span><span class="nf">push_back</span><span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">move</span><span class="p">(</span><a href="#126L" class="nv">lnk</a><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="131L" class="Ln">        <a href="#97L" class="nv">m</a> <span class="o">=</span> <span class="o">&amp;</span><a href="#95L" class="nv">markups</a><span class="p">.</span><span class="nf">back</span><span class="p">(</span><span class="p">)</span><span class="p">;</span></span>
<span id="132L" class="Ln">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><a href="#equalFileLocations:CXSourceLocation,CXSourceLocation" class="nf">equalFileLocations</a><span class="p">(</span></span>
<span id="133L" class="Ln">        <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getRangeStart:CXSourceRange" class="nf">clang_getRangeStart</a><span class="p">(</span><a href="#99L" class="nv">rng</a><span class="p">)</span><span class="p">,</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getCursorLocation:CXCursor" class="nf">clang_getCursorLocation</a><span class="p">(</span><a href="#93L" class="nv">cur</a><span class="p">)</span><span class="p">)</span></span>
<span id="134L" class="Ln">    <span class="p">)</span> <span class="p">{</span></span>
<span id="135L" class="Ln">        <span class="c">// Note that there is magic in the offset with which equalFileLocations</span></span>
<span id="136L" class="Ln">        <span class="c">// works (and clang_equalLocations too); it is sometimes different from</span></span>
<span id="137L" class="Ln">        <span class="c">// what line:column would suggest. Otherwise this condition would not</span></span>
<span id="138L" class="Ln">        <span class="c">// correctly work because e.g. for a function with built-in return type,</span></span>
<span id="139L" class="Ln">        <span class="c">// the cursor location of the FunctionDecl starts at the return type</span></span>
<span id="140L" class="Ln">        <span class="c">// declaration according to line:column, but at the function name (or</span></span>
<span id="141L" class="Ln">        <span class="c">// operator keyword or dtor tilde) according to the offset.</span></span>
<span id="142L" class="Ln">        <span class="k">return</span><span class="p">;</span></span>
<span id="143L" class="Ln">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><a href="#117L" class="nv">k</a> <span class="o">==</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXCursorKind::CXCursor_InclusionDirective" class="no">CXCursor_InclusionDirective</a><span class="p">)</span> <span class="p">{</span></span>
<span id="144L" class="Ln">        <a href="output.hpp.html#synth::Markup" class="nc">Markup</a> <span class="def decl nv">incLnk</span> <span class="p">=</span> <span class="p">{</span><span class="p">}</span><span class="p">;</span></span>
<span id="145L" class="Ln">        <a href="../lib-llvm/include/clang-c/Index.h.html#378L" class="nc">CXSourceRange</a> <span class="def decl nv">incrng</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getCursorExtent:CXCursor" class="nf">clang_getCursorExtent</a><span class="p">(</span><a href="#93L" class="nv">cur</a><span class="p">)</span><span class="p">;</span></span>
<span id="146L" class="Ln">        <a href="#144L" class="nv">incLnk</a><span class="p">.</span><a href="output.hpp.html#synth::Markup::beginOffset" class="vi">beginOffset</a> <span class="o">=</span> <a href="#getLocOffset:CXSourceLocation" class="nf">getLocOffset</a><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_getRangeStart:CXSourceRange" class="nf">clang_getRangeStart</a><span class="p">(</span><a href="#145L" class="nv">incrng</a><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="147L" class="Ln">        <a href="#144L" class="nv">incLnk</a><span class="p">.</span><a href="output.hpp.html#synth::Markup::endOffset" class="vi">endOffset</a> <span class="o">=</span> <a href="#getLocOffset:CXSourceLocation" class="nf">getLocOffset</a><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_getRangeEnd:CXSourceRange" class="nf">clang_getRangeEnd</a><span class="p">(</span><a href="#145L" class="nv">incrng</a><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="148L" class="Ln">        <a href="xref.hpp.html#synth::linkCursor:synth::Markup&amp;,CXCursor,synth::MultiTuProcessor&amp;" class="nf">linkCursor</a><span class="p">(</span><a href="#144L" class="nv">incLnk</a><span class="p">,</span> <a href="#93L" class="nv">cur</a><span class="p">,</span> <a href="#93L" class="nv">state</a><span class="p">.</span><a href="#FileState::tuState" class="vi">tuState</a><span class="p">.</span><a href="#TuState::multiTuProcessor" class="vi">multiTuProcessor</a><span class="p">)</span><span class="p">;</span></span>
<span id="149L" class="Ln">        <span class="k">if</span> <span class="p">(</span><a href="#144L" class="nv">incLnk</a><span class="p">.</span><a href="output.hpp.html#synth::Markup::isRef" class="nf">isRef</a><span class="p">(</span><span class="p">)</span><span class="p">)</span></span>
<span id="150L" class="Ln">            <a href="#93L" class="nv">state</a><span class="p">.</span><a href="#FileState::hlFile" class="vi">hlFile</a><span class="p">.</span><a href="output.hpp.html#synth::HighlightedFile::markups" class="vi">markups</a><span class="p">.</span><span class="nf">push_back</span><span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">move</span><span class="p">(</span><a href="#144L" class="nv">incLnk</a><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="151L" class="Ln">        <span class="k">return</span><span class="p">;</span></span>
<span id="152L" class="Ln">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><a href="#117L" class="nv">k</a> <span class="o">==</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXCursorKind::CXCursor_Destructor" class="no">CXCursor_Destructor</a><span class="p">)</span> <span class="p">{</span></span>
<span id="153L" class="Ln">        <span class="c">// This is the "~" of a dtor. Include the next part in the link.</span></span>
<span id="154L" class="Ln">        <a href="#93L" class="nv">state</a><span class="p">.</span><a href="#FileState::lnkPending" class="vi">lnkPending</a> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></span>
<span id="155L" class="Ln">        <span class="k">return</span><span class="p">;</span></span>
<span id="156L" class="Ln">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><a href="#113L" class="nv">tk</a> <span class="o">==</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXTokenKind::CXToken_Keyword" class="no">CXToken_Keyword</a></span>
<span id="157L" class="Ln">        <span class="o">&amp;&amp;</span> <span class="p">(</span><a href="#117L" class="nv">k</a> <span class="o">==</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXCursorKind::CXCursor_FunctionDecl" class="no">CXCursor_FunctionDecl</a> <span class="o">||</span> <a href="#117L" class="nv">k</a> <span class="o">==</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXCursorKind::CXCursor_CXXMethod" class="no">CXCursor_CXXMethod</a><span class="p">)</span></span>
<span id="158L" class="Ln">        <span class="o">&amp;&amp;</span> <a href="#110L" class="nv">sp</a> <span class="p">==</span> <span class="s">"operator"</span></span>
<span id="159L" class="Ln">    <span class="p">)</span> <span class="p">{</span></span>
<span id="160L" class="Ln">        <a href="#93L" class="nv">state</a><span class="p">.</span><a href="#FileState::lnkPending" class="vi">lnkPending</a> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></span>
<span id="161L" class="Ln">        <span class="k">return</span><span class="p">;</span></span>
<span id="162L" class="Ln">    <span class="p">}</span> </span>
<span id="163L" class="Ln"></span>
<span id="164L" class="Ln">    <span class="c">// Non-KWs: Avoids emitting duplicate names at least for</span></span>
<span id="165L" class="Ln">    <span class="c">// template &lt;typename T> using Foo = /* .. */;</span></span>
<span id="166L" class="Ln">    <span class="c">// where both the "using" and the "Foo" were independenty linked.</span></span>
<span id="167L" class="Ln">    <span class="c">// "{" was highlighted as definition for anonymous namespaces.</span></span>
<span id="168L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="#113L" class="nv">tk</a> <span class="o">!=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXTokenKind::CXToken_Keyword" class="no">CXToken_Keyword</a></span>
<span id="169L" class="Ln">        <span class="o">&amp;&amp;</span> <span class="p">(</span><a href="#113L" class="nv">tk</a> <span class="o">!=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXTokenKind::CXToken_Punctuation" class="no">CXToken_Punctuation</a> <span class="o">||</span> <span class="p">(</span><a href="#110L" class="nv">sp</a> <span class="p">!=</span> <span class="s">"{"</span> <span class="o">&amp;&amp;</span> <a href="#110L" class="nv">sp</a> <span class="p">!=</span> <span class="s">";"</span><span class="p">)</span><span class="p">)</span></span>
<span id="170L" class="Ln">    <span class="p">)</span> <span class="p">{</span></span>
<span id="171L" class="Ln">        <a href="output.hpp.html#synth::SymbolDeclaration" class="nc">SymbolDeclaration</a><span class="p">*</span> <span class="def decl nv">decl</span> <span class="p">=</span> <span class="kc">nullptr</span><span class="p">;</span></span>
<span id="172L" class="Ln">        <span class="kd">auto</span> <span class="kd">const</span> <span class="def decl nv">loadDecl</span> <span class="p">=</span> <span class="p">[</span><span class="p">&amp;</span><span class="p">]</span><span class="p">(</span><span class="p">)</span> <span class="p">{</span></span>
<span id="173L" class="Ln">            <span class="k">if</span> <span class="p">(</span><a href="#171L" class="nv">decl</a><span class="p">)</span></span>
<span id="174L" class="Ln">                <span class="k">return</span><span class="p">;</span></span>
<span id="175L" class="Ln">            <a href="#171L" class="nv">decl</a> <span class="o">=</span> <span class="o">&amp;</span><a href="#93L" class="nv">state</a><span class="p">.</span><a href="#FileState::tuState" class="vi">tuState</a><span class="p">.</span><a href="#TuState::multiTuProcessor" class="vi">multiTuProcessor</a><span class="p">.</span><a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::createSymbol:const-synth::HighlightedFile&amp;,unsigned-int,unsigned-int" class="nf">createSymbol</a><span class="p">(</span></span>
<span id="176L" class="Ln">                <a href="#93L" class="nv">state</a><span class="p">.</span><a href="#FileState::hlFile" class="vi">hlFile</a><span class="p">,</span></span>
<span id="177L" class="Ln">                <a href="#100L" class="nv">lineno</a><span class="p">,</span></span>
<span id="178L" class="Ln">                <a href="#97L" class="nv">m</a><span class="p">-></span><a href="output.hpp.html#synth::Markup::beginOffset" class="vi">beginOffset</a><span class="p">)</span><span class="p">;</span></span>
<span id="179L" class="Ln"></span>
<span id="180L" class="Ln">            <span class="cp">assert</span>(<a href="#171L" class="nv">decl</a><span class="p">-></span><a href="output.hpp.html#synth::SymbolDeclaration::fileUniqueName" class="vi">fileUniqueName</a><span class="p">.</span><span class="nf">empty</span><span class="p">(</span><span class="p">)</span>)<span class="p">;</span></span>
<span id="181L" class="Ln">            <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/types/size_t" class="nc">size_t</a> <span class="def decl nv">maxIdSz</span> <span class="p">=</span> <a href="#93L" class="nv">state</a><span class="p">.</span><a href="#FileState::tuState" class="vi">tuState</a><span class="p">.</span><a href="#TuState::multiTuProcessor" class="vi">multiTuProcessor</a><span class="p">.</span><a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::maxIdSz" class="nf">maxIdSz</a><span class="p">(</span><span class="p">)</span><span class="p">;</span></span>
<span id="182L" class="Ln">            <span class="k">if</span> <span class="p">(</span><a href="#181L" class="nv">maxIdSz</a> <span class="o">></span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span></span>
<span id="183L" class="Ln">                <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/string/basic_string" class="nc">string</a> <span class="def decl nv">name</span> <span class="p">=</span> <a href="xref.hpp.html#synth::fileUniqueName:CXCursor,bool" class="nf">fileUniqueName</a><span class="p">(</span><a href="#93L" class="nv">cur</a><span class="p">,</span> <a href="#93L" class="nv">state</a><span class="p">.</span><a href="#FileState::tuState" class="vi">tuState</a><span class="p">.</span><a href="#TuState::isC" class="vi">isC</a><span class="p">)</span><span class="p">;</span></span>
<span id="184L" class="Ln">                <span class="k">if</span> <span class="p">(</span><a href="#183L" class="nv">name</a><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="p">)</span> <span class="o">&lt;</span> <a href="#181L" class="nv">maxIdSz</a><span class="p">)</span> <span class="p">{</span></span>
<span id="185L" class="Ln">                    <a href="#171L" class="nv">decl</a><span class="p">-></span><a href="output.hpp.html#synth::SymbolDeclaration::fileUniqueName" class="vi">fileUniqueName</a> <span class="p">=</span> <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">move</span><span class="p">(</span><a href="#183L" class="nv">name</a><span class="p">)</span><span class="p">;</span></span>
<span id="186L" class="Ln">                    <a href="#97L" class="nv">m</a><span class="p">-></span><a href="output.hpp.html#synth::Markup::fileUniqueName" class="vi">fileUniqueName</a> <span class="o">=</span> <span class="o">&amp;</span><a href="#171L" class="nv">decl</a><span class="p">-></span><a href="output.hpp.html#synth::SymbolDeclaration::fileUniqueName" class="vi">fileUniqueName</a><span class="p">;</span></span>
<span id="187L" class="Ln">                <span class="p">}</span></span>
<span id="188L" class="Ln">            <span class="p">}</span></span>
<span id="189L" class="Ln">        <span class="p">}</span><span class="p">;</span></span>
<span id="190L" class="Ln"></span>
<span id="191L" class="Ln">        <span class="k">if</span> <span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_isDeclaration:enum-CXCursorKind" class="nf">clang_isDeclaration</a><span class="p">(</span><a href="#117L" class="nv">k</a><span class="p">)</span><span class="p">)</span> <span class="p">{</span></span>
<span id="192L" class="Ln">            <a href="#97L" class="nv">m</a><span class="p">-></span><a href="output.hpp.html#synth::Markup::attrs" class="vi">attrs</a> <a href="output.hpp.html#79L" class="p">|=</a> <a href="output.hpp.html#synth::TokenAttributes" class="nc">TokenAttributes</a><span class="p">::</span><a href="output.hpp.html#synth::TokenAttributes::flagDecl" class="no">flagDecl</a><span class="p">;</span></span>
<span id="193L" class="Ln">            <a href="#172L" class="nv">loadDecl</a><a href="#172L" class="p">(</a><span class="p">)</span><span class="p">;</span></span>
<span id="194L" class="Ln">        <span class="p">}</span></span>
<span id="195L" class="Ln"></span>
<span id="196L" class="Ln">        <a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="nc">CXCursor</a> <span class="def decl nv">defcur</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getCursorDefinition:CXCursor" class="nf">clang_getCursorDefinition</a><span class="p">(</span><a href="#93L" class="nv">cur</a><span class="p">)</span><span class="p">;</span></span>
<span id="197L" class="Ln">        <span class="k">if</span> <span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_equalCursors:CXCursor,CXCursor" class="nf">clang_equalCursors</a><span class="p">(</span><a href="#196L" class="nv">defcur</a><span class="p">,</span> <a href="#93L" class="nv">cur</a><span class="p">)</span><span class="p">)</span> <span class="p">{</span> <span class="c">// This is a definition:</span></span>
<span id="198L" class="Ln">            <a href="#97L" class="nv">m</a><span class="p">-></span><a href="output.hpp.html#synth::Markup::attrs" class="vi">attrs</a> <a href="output.hpp.html#79L" class="p">|=</a> <a href="output.hpp.html#synth::TokenAttributes" class="nc">TokenAttributes</a><span class="p">::</span><a href="output.hpp.html#synth::TokenAttributes::flagDef" class="no">flagDef</a><span class="p">;</span></span>
<span id="199L" class="Ln">            <a href="#172L" class="nv">loadDecl</a><a href="#172L" class="p">(</a><span class="p">)</span><span class="p">;</span></span>
<span id="200L" class="Ln">            <a href="CgStr.hpp.html#synth::CgStr" class="nc">CgStr</a> <span class="def decl nv">usr</span><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_getCursorUSR:CXCursor" class="nf">clang_getCursorUSR</a><span class="p">(</span><a href="#93L" class="nv">cur</a><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="201L" class="Ln">            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><a href="#200L" class="nv">usr</a><span class="p">.</span><a href="CgStr.hpp.html#synth::CgStr::empty" class="nf">empty</a><span class="p">(</span><span class="p">)</span><span class="p">)</span></span>
<span id="202L" class="Ln">                <a href="#93L" class="nv">state</a><span class="p">.</span><a href="#FileState::tuState" class="vi">tuState</a><span class="p">.</span><a href="#TuState::multiTuProcessor" class="vi">multiTuProcessor</a><span class="p">.</span><a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::registerDef:std::string&amp;&amp;,const-synth::SymbolDeclaration*" class="nf">registerDef</a><span class="p">(</span><a href="#200L" class="nv">usr</a><span class="p">.</span><a href="CgStr.hpp.html#synth::CgStr::get" class="nf">get</a><span class="p">(</span><span class="p">)</span><span class="p">,</span> <a href="#171L" class="nv">decl</a><span class="p">)</span><span class="p">;</span></span>
<span id="203L" class="Ln">        <span class="p">}</span></span>
<span id="204L" class="Ln">    <span class="p">}</span></span>
<span id="205L" class="Ln"></span>
<span id="206L" class="Ln">    <span class="cp">assert</span>(<a href="#97L" class="nv">m</a><span class="p">-></span><a href="output.hpp.html#synth::Markup::beginOffset" class="vi">beginOffset</a> <span class="p">&lt;</span> <a href="#97L" class="nv">m</a><span class="p">-></span><a href="output.hpp.html#synth::Markup::endOffset" class="vi">endOffset</a>)<span class="p">;</span></span>
<span id="207L" class="Ln">    <a href="xref.hpp.html#synth::linkCursor:synth::Markup&amp;,CXCursor,synth::MultiTuProcessor&amp;" class="nf">linkCursor</a><span class="p">(</span><span class="o">*</span><a href="#97L" class="nv">m</a><span class="p">,</span> <a href="#93L" class="nv">cur</a><span class="p">,</span> <a href="#93L" class="nv">state</a><span class="p">.</span><a href="#FileState::tuState" class="vi">tuState</a><span class="p">.</span><a href="#TuState::multiTuProcessor" class="vi">multiTuProcessor</a><span class="p">)</span><span class="p">;</span></span>
<span id="208L" class="Ln"><span class="p">}</span></span>
<span id="209L" class="Ln"></span>
<span id="210L" class="Ln"><span class="kd">static</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXChildVisitResult" class="nc">CXChildVisitResult</a> <span class="def decl nf" id="annotateVisit:CXCursor,CXCursor,CXClientData">annotateVisit</span><span class="p">(</span></span>
<span id="211L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="nc">CXCursor</a> <span class="def decl nv">c</span><span class="p">,</span> <a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="nc">CXCursor</a><span class="def decl p">,</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXClientData" class="nc">CXClientData</a> <span class="def decl nv">ud</span><span class="p">)</span></span>
<span id="212L" class="Ln"><span class="p">{</span></span>
<span id="213L" class="Ln">    <span class="kd">auto</span><span class="p">&amp;</span> <span class="def decl nv">state</span> <span class="p">=</span> <span class="o">*</span><span class="k">static_cast</span><span class="p">&lt;</span><a href="#TuState" class="nc">TuState</a><span class="p">*</span><span class="p">></span><span class="p">(</span><a href="#211L" class="nv">ud</a><span class="p">)</span><span class="p">;</span></span>
<span id="214L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="#213L" class="nv">state</a><span class="p">.</span><a href="#TuState::isC" class="vi">isC</a><span class="p">)</span> <span class="p">{</span></span>
<span id="215L" class="Ln">        <a href="../lib-llvm/include/clang-c/Index.h.html#CXLanguageKind" class="nc">CXLanguageKind</a> <span class="def decl nv">lang</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getCursorLanguage:CXCursor" class="nf">clang_getCursorLanguage</a><span class="p">(</span><a href="#211L" class="nv">c</a><span class="p">)</span><span class="p">;</span></span>
<span id="216L" class="Ln">        <a href="#213L" class="nv">state</a><span class="p">.</span><a href="#TuState::isC" class="vi">isC</a> <span class="o">=</span> <a href="#215L" class="nv">lang</a> <span class="o">==</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXLanguageKind::CXLanguage_C" class="no">CXLanguage_C</a> <span class="o">||</span> <a href="#215L" class="nv">lang</a> <span class="o">==</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXLanguageKind::CXLanguage_Invalid" class="no">CXLanguage_Invalid</a><span class="p">;</span></span>
<span id="217L" class="Ln">    <span class="p">}</span></span>
<span id="218L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#CXFile" class="nc">CXFile</a> <span class="def decl nv">f</span><span class="p">;</span></span>
<span id="219L" class="Ln">    <span class="kt">unsigned</span> <span class="def decl nv">ln</span><span class="p">,</span> <span class="def decl nv">off</span><span class="p">;</span></span>
<span id="220L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getFileLocation:CXSourceLocation,CXFile*,unsigned-int*,unsigned-int*,unsigned-int*" class="nf">clang_getFileLocation</a><span class="p">(</span></span>
<span id="221L" class="Ln">        <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getCursorLocation:CXCursor" class="nf">clang_getCursorLocation</a><span class="p">(</span><a href="#211L" class="nv">c</a><span class="p">)</span><span class="p">,</span> <span class="o">&amp;</span><a href="#218L" class="nv">f</a><span class="p">,</span> <span class="o">&amp;</span><a href="#219L" class="nv">ln</a><span class="p">,</span> <span class="kc">nullptr</span><span class="p">,</span> <span class="o">&amp;</span><a href="#219L" class="nv">off</a><span class="p">)</span><span class="p">;</span></span>
<span id="222L" class="Ln">    <a href="#FileAnnotationState" class="nc">FileAnnotationState</a><span class="p">*</span> <span class="def decl nv">astate</span> <span class="p">=</span> <a href="#lookupFileAnnotations:TuAnnotationMap&amp;,CXFile" class="nf">lookupFileAnnotations</a><span class="p">(</span><a href="#213L" class="nv">state</a><span class="p">.</span><a href="#TuState::annotationMap" class="vi">annotationMap</a><span class="p">,</span> <a href="#218L" class="nv">f</a><span class="p">)</span><span class="p">;</span></span>
<span id="223L" class="Ln">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><a href="#222L" class="nv">astate</a><span class="p">)</span></span>
<span id="224L" class="Ln">        <span class="k">return</span> <a href="#219L" class="nv">ln</a> <span class="o">==</span> <span class="m">0</span> <span class="p">?</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXChildVisitResult::CXChildVisit_Recurse" class="no">CXChildVisit_Recurse</a> <span class="p">:</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXChildVisitResult::CXChildVisit_Continue" class="no">CXChildVisit_Continue</a><span class="p">;</span></span>
<span id="225L" class="Ln"></span>
<span id="226L" class="Ln">    <span class="kd">auto</span> <span class="def decl nv">itIdx</span> <span class="p">=</span> <a href="#222L" class="nv">astate</a><span class="p">-></span><a href="#FileAnnotationState::locationMap" class="vi">locationMap</a><span class="p">.</span><span class="nf">find</span><span class="p">(</span><a href="#219L" class="nv">off</a><span class="p">)</span><span class="p">;</span></span>
<span id="227L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="#226L" class="nv">itIdx</a> <span class="p">==</span> <a href="#222L" class="nv">astate</a><span class="p">-></span><a href="#FileAnnotationState::locationMap" class="vi">locationMap</a><span class="p">.</span><span class="nf">end</span><span class="p">(</span><span class="p">)</span></span>
<span id="228L" class="Ln">        <span class="o">||</span> <span class="o">!</span><a href="#222L" class="nv">astate</a><span class="p">-></span><a href="#FileAnnotationState::annotationBad" class="vi">annotationBad</a><span class="p">[</span><a href="#226L" class="nv">itIdx</a><span class="p">-></span><span class="vi">second</span><span class="p">]</span></span>
<span id="229L" class="Ln">    <span class="p">)</span> <span class="p">{</span></span>
<span id="230L" class="Ln">        <span class="k">return</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXChildVisitResult::CXChildVisit_Recurse" class="no">CXChildVisit_Recurse</a><span class="p">;</span></span>
<span id="231L" class="Ln">    <span class="p">}</span></span>
<span id="232L" class="Ln"></span>
<span id="233L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="nc">CXCursor</a><span class="p">&amp;</span> <span class="def decl nv">acur</span> <span class="p">=</span> <a href="#222L" class="nv">astate</a><span class="p">-></span><a href="#FileAnnotationState::annotations" class="vi">annotations</a><span class="p">[</span><a href="#226L" class="nv">itIdx</a><span class="p">-></span><span class="vi">second</span><span class="p">]</span><span class="p">;</span></span>
<span id="234L" class="Ln">    <a href="#233L" class="nv">acur</a> <a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="p">=</a> <a href="#211L" class="nv">c</a><span class="p">;</span></span>
<span id="235L" class="Ln">    <span class="k">return</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXChildVisitResult::CXChildVisit_Recurse" class="no">CXChildVisit_Recurse</a><span class="p">;</span></span>
<span id="236L" class="Ln"><span class="p">}</span></span>
<span id="237L" class="Ln"></span>
<span id="238L" class="Ln"><span class="kd">static</span> <span class="kt">void</span> <span class="def decl nf" id="annotate:(anonymous-namespace)::TuState&amp;,CXCursor">annotate</span><span class="p">(</span><a href="#TuState" class="nc">TuState</a><span class="p">&amp;</span> <span class="def decl nv">state</span><span class="p">,</span> <a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="nc">CXCursor</a> <span class="def decl nv">root</span><span class="p">)</span></span>
<span id="239L" class="Ln"><span class="p">{</span></span>
<span id="240L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#clang_visitChildren:CXCursor,CXCursorVisitor,CXClientData" class="nf">clang_visitChildren</a><span class="p">(</span><a href="#238L" class="nv">root</a><span class="p">,</span> <span class="o">&amp;</span><a href="#annotateVisit:CXCursor,CXCursor,CXClientData" class="nf">annotateVisit</a><span class="p">,</span> <span class="o">&amp;</span><a href="#238L" class="nv">state</a><span class="p">)</span><span class="p">;</span></span>
<span id="241L" class="Ln"><span class="p">}</span></span>
<span id="242L" class="Ln"></span>
<span id="243L" class="Ln"><span class="kd">static</span> <span class="kt">void</span> <span class="def decl nf" id="processFile:CXFile,CXSourceLocation*,unsigned-int,CXClientData">processFile</span><span class="p">(</span></span>
<span id="244L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#CXFile" class="nc">CXFile</a> <span class="def decl nv">file</span><span class="p">,</span> <a href="../lib-llvm/include/clang-c/Index.h.html#367L" class="nc">CXSourceLocation</a><span class="p">*</span><span class="def decl p">,</span> <span class="kt">unsigned</span><span class="def decl p">,</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXClientData" class="nc">CXClientData</a> <span class="def decl nv">ud</span><span class="p">)</span></span>
<span id="245L" class="Ln"><span class="p">{</span></span>
<span id="246L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#302L" class="nc">CXFileUniqueID</a> <span class="def decl nv">fuid</span><span class="p">;</span></span>
<span id="247L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_getFileUniqueID:CXFile,CXFileUniqueID*" class="nf">clang_getFileUniqueID</a><span class="p">(</span><a href="#244L" class="nv">file</a><span class="p">,</span> <span class="o">&amp;</span><a href="#246L" class="nv">fuid</a><span class="p">)</span> <span class="o">!=</span> <span class="m">0</span><span class="p">)</span></span>
<span id="248L" class="Ln">        <span class="k">return</span><span class="p">;</span></span>
<span id="249L" class="Ln"></span>
<span id="250L" class="Ln">    <span class="kd">auto</span><span class="p">&amp;</span> <span class="def decl nv">state</span> <span class="p">=</span> <span class="o">*</span><span class="k">static_cast</span><span class="p">&lt;</span><a href="#TuState" class="nc">TuState</a><span class="p">*</span><span class="p">></span><span class="p">(</span><a href="#244L" class="nv">ud</a><span class="p">)</span><span class="p">;</span></span>
<span id="251L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#CXTranslationUnit" class="nc">CXTranslationUnit</a> <span class="def decl nv">tu</span> <span class="p">=</span> <a href="#250L" class="nv">state</a><span class="p">.</span><a href="#TuState::tu" class="vi">tu</a><span class="p">;</span></span>
<span id="252L" class="Ln"></span>
<span id="253L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#367L" class="nc">CXSourceLocation</a> <span class="def decl nv">beg</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getLocationForOffset:CXTranslationUnit,CXFile,unsigned-int" class="nf">clang_getLocationForOffset</a><span class="p">(</span><a href="#251L" class="nv">tu</a><span class="p">,</span> <a href="#244L" class="nv">file</a><span class="p">,</span> <span class="m">0</span><span class="p">)</span><span class="p">;</span></span>
<span id="254L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#367L" class="nc">CXSourceLocation</a> <span class="def decl nv">end</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getLocation:CXTranslationUnit,CXFile,unsigned-int,unsigned-int" class="nf">clang_getLocation</a><span class="p">(</span><a href="#251L" class="nv">tu</a><span class="p">,</span> <a href="#244L" class="nv">file</a><span class="p">,</span> <span class="cp">UINT_MAX</span><span class="p">,</span> <span class="cp">UINT_MAX</span><span class="p">)</span><span class="p">;</span></span>
<span id="255L" class="Ln"></span>
<span id="256L" class="Ln">    <a href="output.hpp.html#synth::HighlightedFile" class="nc">HighlightedFile</a><span class="p">*</span> <span class="def decl nv">hlFile</span> <span class="p">=</span> <a href="#250L" class="nv">state</a><span class="p">.</span><a href="#TuState::multiTuProcessor" class="vi">multiTuProcessor</a><span class="p">.</span><a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor::prepareToProcess:CXFile" class="nf">prepareToProcess</a><span class="p">(</span><a href="#244L" class="nv">file</a><span class="p">)</span><span class="p">;</span></span>
<span id="257L" class="Ln">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><a href="#256L" class="nv">hlFile</a><span class="p">)</span></span>
<span id="258L" class="Ln">        <span class="k">return</span><span class="p">;</span></span>
<span id="259L" class="Ln"></span>
<span id="260L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#4250L" class="nc">CXToken</a><span class="p">*</span> <span class="def decl nv">tokens</span><span class="p">;</span></span>
<span id="261L" class="Ln">    <span class="kt">unsigned</span> <span class="def decl nv">numTokens</span><span class="p">;</span></span>
<span id="262L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#clang_tokenize:CXTranslationUnit,CXSourceRange,CXToken**,unsigned-int*" class="nf">clang_tokenize</a><span class="p">(</span><a href="#251L" class="nv">tu</a><span class="p">,</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getRange:CXSourceLocation,CXSourceLocation" class="nf">clang_getRange</a><span class="p">(</span><a href="#253L" class="nv">beg</a><span class="p">,</span> <a href="#254L" class="nv">end</a><span class="p">)</span><span class="p">,</span> <span class="o">&amp;</span><a href="#260L" class="nv">tokens</a><span class="p">,</span> <span class="o">&amp;</span><a href="#261L" class="nv">numTokens</a><span class="p">)</span><span class="p">;</span></span>
<span id="263L" class="Ln">    <a href="cgWrappers.hpp.html#synth::CgTokensHandle" class="nc">CgTokensHandle</a> <span class="def decl nv">hToks</span><span class="p">(</span><a href="#260L" class="nv">tokens</a><span class="p">,</span> <a href="#261L" class="nv">numTokens</a><span class="p">,</span> <a href="#251L" class="nv">tu</a><span class="p">)</span><span class="p">;</span></span>
<span id="264L" class="Ln"></span>
<span id="265L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="#261L" class="nv">numTokens</a> <span class="o">==</span> <span class="m">0</span><span class="p">)</span></span>
<span id="266L" class="Ln">        <span class="k">return</span><span class="p">;</span></span>
<span id="267L" class="Ln"></span>
<span id="268L" class="Ln">    <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/container/vector" class="nc">vector</a><span class="p">&lt;</span><a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="nc">CXCursor</a><span class="p">></span> <span class="def decl nv">annotations</span><span class="p">(</span><a href="#261L" class="nv">numTokens</a><span class="p">)</span><span class="p">;</span></span>
<span id="269L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#clang_annotateTokens:CXTranslationUnit,CXToken*,unsigned-int,CXCursor*" class="nf">clang_annotateTokens</a><span class="p">(</span><a href="#251L" class="nv">tu</a><span class="p">,</span> <a href="#260L" class="nv">tokens</a><span class="p">,</span> <a href="#261L" class="nv">numTokens</a><span class="p">,</span> <a href="#268L" class="nv">annotations</a><span class="p">.</span><span class="nf">data</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="270L" class="Ln">    <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/container/vector" class="nc">vector</a><span class="p">&lt;</span><span class="kt">bool</span><span class="p">></span> <span class="def decl nv">annotationBad</span><span class="p">(</span><a href="#261L" class="nv">numTokens</a><span class="p">)</span><span class="p">;</span></span>
<span id="271L" class="Ln"></span>
<span id="272L" class="Ln">    <span class="k">for</span> <span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/types/size_t" class="nc">size_t</a> <span class="def decl nv">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <a href="#272L" class="nv">i</a> <span class="o">&lt;</span> <a href="#261L" class="nv">numTokens</a><span class="p">;</span> <span class="o">++</span><a href="#272L" class="nv">i</a><span class="p">)</span> <span class="p">{</span></span>
<span id="273L" class="Ln">        <a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="nc">CXCursor</a><span class="p">&amp;</span> <span class="def decl nv">cur</span> <span class="p">=</span> <a href="#268L" class="nv">annotations</a><span class="p">[</span><a href="#272L" class="nv">i</a><span class="p">]</span><span class="p">;</span></span>
<span id="274L" class="Ln">        <a href="../lib-llvm/include/clang-c/Index.h.html#367L" class="nc">CXSourceLocation</a> <span class="def decl nv">tokLoc</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getTokenLocation:CXTranslationUnit,CXToken" class="nf">clang_getTokenLocation</a><span class="p">(</span><a href="#251L" class="nv">tu</a><span class="p">,</span> <a href="#260L" class="nv">tokens</a><span class="p">[</span><a href="#272L" class="nv">i</a><span class="p">]</span><span class="p">)</span><span class="p">;</span></span>
<span id="275L" class="Ln">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><a href="#equalFileLocations:CXSourceLocation,CXSourceLocation" class="nf">equalFileLocations</a><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_getCursorLocation:CXCursor" class="nf">clang_getCursorLocation</a><span class="p">(</span><a href="#273L" class="nv">cur</a><span class="p">)</span><span class="p">,</span> <a href="#274L" class="nv">tokLoc</a><span class="p">)</span><span class="p">)</span> <span class="p">{</span></span>
<span id="276L" class="Ln">            <a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="nc">CXCursor</a> <span class="def decl nv">c2</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getCursor:CXTranslationUnit,CXSourceLocation" class="nf">clang_getCursor</a><span class="p">(</span><a href="#251L" class="nv">tu</a><span class="p">,</span> <a href="#274L" class="nv">tokLoc</a><span class="p">)</span><span class="p">;</span></span>
<span id="277L" class="Ln">            <a href="../lib-llvm/include/clang-c/Index.h.html#367L" class="nc">CXSourceLocation</a> <span class="def decl nv">loc2</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getCursorLocation:CXCursor" class="nf">clang_getCursorLocation</a><span class="p">(</span><a href="#276L" class="nv">c2</a><span class="p">)</span><span class="p">;</span></span>
<span id="278L" class="Ln">            <span class="k">if</span> <span class="p">(</span><a href="#equalFileLocations:CXSourceLocation,CXSourceLocation" class="nf">equalFileLocations</a><span class="p">(</span><a href="#277L" class="nv">loc2</a><span class="p">,</span> <a href="#274L" class="nv">tokLoc</a><span class="p">)</span><span class="p">)</span></span>
<span id="279L" class="Ln">                <a href="#273L" class="nv">cur</a> <a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="p">=</a> <a href="#276L" class="nv">c2</a><span class="p">;</span></span>
<span id="280L" class="Ln">            <span class="k">else</span></span>
<span id="281L" class="Ln">                <a href="#270L" class="nv">annotationBad</a><span class="p">[</span><a href="#272L" class="nv">i</a><span class="p">]</span> <span class="p">=</span> <span class="kc">true</span><span class="p">;</span></span>
<span id="282L" class="Ln">        <span class="p">}</span></span>
<span id="283L" class="Ln">    <span class="p">}</span></span>
<span id="284L" class="Ln"></span>
<span id="285L" class="Ln">    <a href="cgWrappers.hpp.html#synth::CgSourceRangesHandle" class="nc">CgSourceRangesHandle</a> <span class="def decl nv">skippedRanges</span><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_getSkippedRanges:CXTranslationUnit,CXFile" class="nf">clang_getSkippedRanges</a><span class="p">(</span><a href="#251L" class="nv">tu</a><span class="p">,</span> <a href="#244L" class="nv">file</a><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="286L" class="Ln">    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="def decl nv">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <a href="#286L" class="nv">i</a> <span class="o">&lt;</span> <a href="#285L" class="nv">skippedRanges</a><span class="p">-></span><a href="../lib-llvm/include/clang-c/Index.h.html#CXSourceRangeList::count" class="vi">count</a><span class="p">;</span> <span class="o">++</span><a href="#286L" class="nv">i</a><span class="p">)</span> <span class="p">{</span></span>
<span id="287L" class="Ln">        <a href="../lib-llvm/include/clang-c/Index.h.html#378L" class="nc">CXSourceRange</a> <span class="def decl nv">rng</span> <span class="p">=</span> <a href="#285L" class="nv">skippedRanges</a><span class="p">-></span><a href="../lib-llvm/include/clang-c/Index.h.html#CXSourceRangeList::ranges" class="vi">ranges</a><span class="p">[</span><a href="#286L" class="nv">i</a><span class="p">]</span><span class="p">;</span></span>
<span id="288L" class="Ln">        <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/utility/pair" class="nc">pair</a><span class="p">&lt;</span><span class="kt">unsigned</span><span class="p">,</span> <span class="kt">unsigned</span><span class="p">></span> <span class="def decl nv">skippedRng</span><span class="p">;</span></span>
<span id="289L" class="Ln">        <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getFileLocation:CXSourceLocation,CXFile*,unsigned-int*,unsigned-int*,unsigned-int*" class="nf">clang_getFileLocation</a><span class="p">(</span></span>
<span id="290L" class="Ln">            <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getRangeStart:CXSourceRange" class="nf">clang_getRangeStart</a><span class="p">(</span><a href="#287L" class="nv">rng</a><span class="p">)</span><span class="p">,</span></span>
<span id="291L" class="Ln">            <span class="kc">nullptr</span><span class="p">,</span></span>
<span id="292L" class="Ln">            <span class="o">&amp;</span><a href="#288L" class="nv">skippedRng</a><span class="p">.</span><span class="vi">first</span><span class="p">,</span></span>
<span id="293L" class="Ln">            <span class="kc">nullptr</span><span class="p">,</span></span>
<span id="294L" class="Ln">            <span class="kc">nullptr</span><span class="p">)</span><span class="p">;</span></span>
<span id="295L" class="Ln">        <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getFileLocation:CXSourceLocation,CXFile*,unsigned-int*,unsigned-int*,unsigned-int*" class="nf">clang_getFileLocation</a><span class="p">(</span></span>
<span id="296L" class="Ln">            <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getRangeEnd:CXSourceRange" class="nf">clang_getRangeEnd</a><span class="p">(</span><a href="#287L" class="nv">rng</a><span class="p">)</span><span class="p">,</span></span>
<span id="297L" class="Ln">            <span class="kc">nullptr</span><span class="p">,</span></span>
<span id="298L" class="Ln">            <span class="o">&amp;</span><a href="#288L" class="nv">skippedRng</a><span class="p">.</span><span class="vi">second</span><span class="p">,</span></span>
<span id="299L" class="Ln">            <span class="kc">nullptr</span><span class="p">,</span></span>
<span id="300L" class="Ln">            <span class="kc">nullptr</span><span class="p">)</span><span class="p">;</span></span>
<span id="301L" class="Ln">        <a href="#256L" class="nv">hlFile</a><span class="p">-></span><a href="output.hpp.html#synth::HighlightedFile::disabledLines" class="vi">disabledLines</a><span class="p">.</span><span class="nf">push_back</span><span class="p">(</span><a href="#288L" class="nv">skippedRng</a><span class="p">)</span><span class="p">;</span></span>
<span id="302L" class="Ln">    <span class="p">}</span></span>
<span id="303L" class="Ln">    <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">sort</span><span class="p">(</span><a href="#256L" class="nv">hlFile</a><span class="p">-></span><a href="output.hpp.html#synth::HighlightedFile::disabledLines" class="vi">disabledLines</a><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <a href="#256L" class="nv">hlFile</a><span class="p">-></span><a href="output.hpp.html#synth::HighlightedFile::disabledLines" class="vi">disabledLines</a><span class="p">.</span><span class="nf">end</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="304L" class="Ln"></span>
<span id="305L" class="Ln">    <a href="#FileAnnotationState" class="nc">FileAnnotationState</a> <span class="def decl nv">fstate</span> <span class="p">{</span></span>
<span id="306L" class="Ln">        <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">move</span><span class="p">(</span><a href="#244L" class="nv">file</a><span class="p">)</span><span class="p">,</span></span>
<span id="307L" class="Ln">        <span class="o">*</span><a href="#256L" class="nv">hlFile</a><span class="p">,</span></span>
<span id="308L" class="Ln">        <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">move</span><span class="p">(</span><a href="#263L" class="nv">hToks</a><span class="p">)</span><span class="p">,</span></span>
<span id="309L" class="Ln">        <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">move</span><span class="p">(</span><a href="#268L" class="nv">annotations</a><span class="p">)</span><span class="p">,</span></span>
<span id="310L" class="Ln">        <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">move</span><span class="p">(</span><a href="#270L" class="nv">annotationBad</a><span class="p">)</span><span class="p">,</span></span>
<span id="311L" class="Ln">        <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/container/unordered_map" class="nc">unordered_map</a><span class="p">&lt;</span><span class="kt">unsigned</span><span class="p">,</span> <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/types/size_t" class="nc">size_t</a><span class="p">></span><span class="p">(</span><span class="p">)</span></span>
<span id="312L" class="Ln">    <span class="p">}</span><span class="p">;</span></span>
<span id="313L" class="Ln">    <span class="kd">auto</span> <span class="def decl nv">kv</span> <span class="p">=</span> <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">make_pair</span><span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">move</span><span class="p">(</span><a href="#246L" class="nv">fuid</a><span class="p">)</span><span class="p">,</span> <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">move</span><span class="p">(</span><a href="#305L" class="nv">fstate</a><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="314L" class="Ln">    <span class="kd">auto</span> <span class="def decl nv">insRes</span> <span class="p">=</span> <a href="#250L" class="nv">state</a><span class="p">.</span><a href="#TuState::annotationMap" class="vi">annotationMap</a><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">move</span><span class="p">(</span><a href="#313L" class="nv">kv</a><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="315L" class="Ln">    <span class="cp">assert</span>(<a href="#314L" class="nv">insRes</a><span class="p">.</span><span class="vi">second</span>)<span class="p">;</span></span>
<span id="316L" class="Ln">    <a href="#314L" class="nv">insRes</a><span class="p">.</span><span class="vi">first</span><span class="p">-></span><span class="vi">second</span><span class="p">.</span><a href="#FileAnnotationState::populateLocationMap:CXTranslationUnit" class="nf">populateLocationMap</a><span class="p">(</span><a href="#251L" class="nv">tu</a><span class="p">)</span><span class="p">;</span></span>
<span id="317L" class="Ln"></span>
<span id="318L" class="Ln"><span class="p">}</span></span>
<span id="319L" class="Ln"></span>
<span id="320L" class="Ln"><span class="kd">static</span> <span class="kt">void</span> <span class="def decl nf" id="writeHlTokens:(anonymous-namespace)::TuState&amp;">writeHlTokens</span><span class="p">(</span><a href="#TuState" class="nc">TuState</a><span class="p">&amp;</span> <span class="def decl nv">state</span><span class="p">)</span></span>
<span id="321L" class="Ln"><span class="p">{</span></span>
<span id="322L" class="Ln">    <span class="k">for</span> <span class="p">(</span><span class="kd">auto</span><span class="p">&amp;</span> <span class="def decl nv">fAnnotationsEntry</span> <a href="#322L" class="p">:</a> <a href="#320L" class="nv">state</a><span class="p">.</span><a href="#TuState::annotationMap" class="vi">annotationMap</a><span class="p">)</span> <span class="p">{</span></span>
<span id="323L" class="Ln">        <a href="#FileAnnotationState" class="nc">FileAnnotationState</a><span class="p">&amp;</span> <span class="def decl nv">fAnnotations</span> <span class="p">=</span> <a href="#322L" class="nv">fAnnotationsEntry</a><span class="p">.</span><span class="vi">second</span><span class="p">;</span></span>
<span id="324L" class="Ln">        <a href="#FileState" class="nc">FileState</a> <span class="def decl nv">fstate</span> <span class="p">{</span><a href="#320L" class="nv">state</a><span class="p">,</span> <a href="#323L" class="nv">fAnnotations</a><span class="p">.</span><a href="#FileAnnotationState::hlFile" class="vi">hlFile</a><span class="p">,</span> <span class="c">/*lnkPending=*/</span><span class="kc">false</span><span class="p">}</span><span class="p">;</span></span>
<span id="325L" class="Ln">        <span class="k">for</span> <span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/types/size_t" class="nc">size_t</a> <span class="def decl nv">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <a href="#325L" class="nv">i</a> <span class="o">&lt;</span> <a href="#323L" class="nv">fAnnotations</a><span class="p">.</span><a href="#FileAnnotationState::tokens" class="vi">tokens</a><span class="p">.</span><a href="cgWrappers.hpp.html#synth::CgTokensHandle::size" class="nf">size</a><span class="p">(</span><span class="p">)</span><span class="p">;</span> <span class="o">++</span><a href="#325L" class="nv">i</a><span class="p">)</span> <span class="p">{</span></span>
<span id="326L" class="Ln">            <a href="../lib-llvm/include/clang-c/Index.h.html#4250L" class="nc">CXToken</a> <span class="def decl nv">tok</span> <span class="p">=</span> <a href="#323L" class="nv">fAnnotations</a><span class="p">.</span><a href="#FileAnnotationState::tokens" class="vi">tokens</a><span class="p">.</span><a href="cgWrappers.hpp.html#synth::CgTokensHandle::tokens" class="nf">tokens</a><span class="p">(</span><span class="p">)</span><span class="p">[</span><a href="#325L" class="nv">i</a><span class="p">]</span><span class="p">;</span></span>
<span id="327L" class="Ln">            <a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="nc">CXCursor</a> <span class="def decl nv">cur</span> <span class="p">=</span> <a href="#323L" class="nv">fAnnotations</a><span class="p">.</span><a href="#FileAnnotationState::annotations" class="vi">annotations</a><span class="p">[</span><a href="#325L" class="nv">i</a><span class="p">]</span><span class="p">;</span></span>
<span id="328L" class="Ln">            <a href="#processToken:(anonymous-namespace)::FileState&amp;,CXToken,CXCursor" class="nf">processToken</a><span class="p">(</span><a href="#324L" class="nv">fstate</a><span class="p">,</span> <a href="#326L" class="nv">tok</a><span class="p">,</span> <a href="#327L" class="nv">cur</a><span class="p">)</span><span class="p">;</span></span>
<span id="329L" class="Ln">        <span class="p">}</span></span>
<span id="330L" class="Ln">        <a href="#323L" class="nv">fAnnotations</a><span class="p">.</span><a href="#FileAnnotationState::hlFile" class="vi">hlFile</a><span class="p">.</span><a href="output.hpp.html#synth::HighlightedFile::markups" class="vi">markups</a><span class="p">.</span><span class="nf">shrink_to_fit</span><span class="p">(</span><span class="p">)</span><span class="p">;</span></span>
<span id="331L" class="Ln">    <span class="p">}</span></span>
<span id="332L" class="Ln"><span class="p">}</span></span>
<span id="333L" class="Ln"></span>
<span id="334L" class="Ln"><span class="kt">int</span> <a href="xref.hpp.html#synth" class="nn">synth</a><span class="p">::</span><span class="def decl nf" id="synth::processTu:CXIndex,synth::MultiTuProcessor&amp;,const-char*const*,int">processTu</span><span class="p">(</span></span>
<span id="335L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#CXIndex" class="nc">CXIndex</a> <span class="def decl nv">cidx</span><span class="p">,</span></span>
<span id="336L" class="Ln">    <a href="MultiTuProcessor.hpp.html#synth::MultiTuProcessor" class="nc">MultiTuProcessor</a><span class="p">&amp;</span> <span class="def decl nv">multiTuProcessor</span><span class="p">,</span></span>
<span id="337L" class="Ln">    <span class="kt">char</span> <span class="kd">const</span><span class="p">*</span> <span class="kd">const</span><span class="p">*</span> <span class="def decl nv">args</span><span class="p">,</span></span>
<span id="338L" class="Ln">    <span class="kt">int</span> <span class="def decl nv">nargs</span><span class="p">)</span></span>
<span id="339L" class="Ln"><span class="p">{</span></span>
<span id="340L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#CXTranslationUnit" class="nc">CXTranslationUnit</a> <span class="def decl nv">tu</span> <span class="p">=</span> <span class="kc">nullptr</span><span class="p">;</span></span>
<span id="341L" class="Ln">    <a href="../lib-llvm/include/clang-c/CXErrorCode.h.html#CXErrorCode" class="nc">CXErrorCode</a> <span class="def decl nv">err</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#1313L" class="nf">clang_parseTranslationUnit2FullArgv</a><span class="p">(</span></span>
<span id="342L" class="Ln">        <a href="#335L" class="nv">cidx</a><span class="p">,</span></span>
<span id="343L" class="Ln">        <span class="c">/*source_filename:*/</span> <span class="kc">nullptr</span><span class="p">,</span> <span class="c">// Included in commandline.</span></span>
<span id="344L" class="Ln">        <a href="#337L" class="nv">args</a><span class="p">,</span></span>
<span id="345L" class="Ln">        <a href="#338L" class="nv">nargs</a><span class="p">,</span></span>
<span id="346L" class="Ln">        <span class="c">/*unsaved_files:*/</span> <span class="kc">nullptr</span><span class="p">,</span></span>
<span id="347L" class="Ln">        <span class="c">/*num_unsaved_files:*/</span> <span class="m">0</span><span class="p">,</span></span>
<span id="348L" class="Ln">        <a href="../lib-llvm/include/clang-c/Index.h.html#CXTranslationUnit_Flags::CXTranslationUnit_DetailedPreprocessingRecord" class="no">CXTranslationUnit_DetailedPreprocessingRecord</a><span class="p">,</span></span>
<span id="349L" class="Ln">        <span class="o">&amp;</span><a href="#340L" class="nv">tu</a><span class="p">)</span><span class="p">;</span></span>
<span id="350L" class="Ln">    <a href="cgWrappers.hpp.html#synth::CgTuHandle" class="nc">CgTuHandle</a> <span class="def decl nv">htu</span><span class="p">(</span><a href="#340L" class="nv">tu</a><span class="p">)</span><span class="p">;</span></span>
<span id="351L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="#341L" class="nv">err</a> <span class="o">!=</span> <a href="../lib-llvm/include/clang-c/CXErrorCode.h.html#CXErrorCode::CXError_Success" class="no">CXError_Success</a><span class="p">)</span> <span class="p">{</span></span>
<span id="352L" class="Ln">        <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">cerr</a> <span class="p">&lt;&lt;</span> <span class="s">"Failed parsing translation unit (code "</span></span>
<span id="353L" class="Ln">                  <span class="p">&lt;&lt;</span> <span class="k">static_cast</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">></span><span class="p">(</span><a href="#341L" class="nv">err</a><span class="p">)</span></span>
<span id="354L" class="Ln">                  <span class="p">&lt;&lt;</span> <span class="s">")\n"</span><span class="p">;</span></span>
<span id="355L" class="Ln">        <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">cerr</a> <span class="p">&lt;&lt;</span> <span class="s">"  args:"</span><span class="p">;</span></span>
<span id="356L" class="Ln">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="def decl nv">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <a href="#356L" class="nv">i</a> <span class="o">&lt;</span> <a href="#338L" class="nv">nargs</a><span class="p">;</span> <span class="o">++</span><a href="#356L" class="nv">i</a><span class="p">)</span></span>
<span id="357L" class="Ln">            <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">cerr</a> <span class="p">&lt;&lt;</span> <span class="sc">' '</span> <span class="p">&lt;&lt;</span> <a href="#337L" class="nv">args</a><span class="p">[</span><a href="#356L" class="nv">i</a><span class="p">]</span><span class="p">;</span></span>
<span id="358L" class="Ln">        <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">cerr</a> <span class="p">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span></span>
<span id="359L" class="Ln">        <span class="k">return</span> <a href="#341L" class="nv">err</a> <span class="o">+</span> <span class="m">10</span><span class="p">;</span></span>
<span id="360L" class="Ln">    <span class="p">}</span></span>
<span id="361L" class="Ln"></span>
<span id="362L" class="Ln">    <a href="#TuState" class="nc">TuState</a> <span class="def decl nv">state</span> <span class="p">{</span><a href="#TuAnnotationMap" class="nc">TuAnnotationMap</a><span class="p">(</span><span class="p">)</span><span class="p">,</span> <a href="#340L" class="nv">tu</a><span class="p">,</span> <a href="#336L" class="nv">multiTuProcessor</a><span class="p">,</span> <span class="c">/*isC=*/</span> <span class="kc">true</span><span class="p">}</span><span class="p">;</span></span>
<span id="363L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getInclusions:CXTranslationUnit,CXInclusionVisitor,CXClientData" class="nf">clang_getInclusions</a><span class="p">(</span><a href="#340L" class="nv">tu</a><span class="p">,</span> <span class="o">&amp;</span><a href="#processFile:CXFile,CXSourceLocation*,unsigned-int,CXClientData" class="nf">processFile</a><span class="p">,</span> <span class="o">&amp;</span><a href="#362L" class="nv">state</a><span class="p">)</span><span class="p">;</span></span>
<span id="364L" class="Ln">    <a href="#annotate:(anonymous-namespace)::TuState&amp;,CXCursor" class="nf">annotate</a><span class="p">(</span><a href="#362L" class="nv">state</a><span class="p">,</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getTranslationUnitCursor:CXTranslationUnit" class="nf">clang_getTranslationUnitCursor</a><span class="p">(</span><a href="#340L" class="nv">tu</a><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="365L" class="Ln">    <a href="#writeHlTokens:(anonymous-namespace)::TuState&amp;" class="nf">writeHlTokens</a><span class="p">(</span><a href="#362L" class="nv">state</a><span class="p">)</span><span class="p">;</span></span>
<span id="366L" class="Ln"></span>
<span id="367L" class="Ln">    <span class="k">return</span> <span class="cp">EXIT_SUCCESS</span><span class="p">;</span></span>
<span id="368L" class="Ln"><span class="p">}</span></span>
<span id="369L" class="Ln"></span>
</pre></div>
        <script src="../code.js"></script>
    </body>
</html>
