<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>src/dbgmain.cpp</title>
        <link rel="stylesheet" href="../codestyle-colorful.css">
    </head>
    <body>
        <div class="highlight"><pre><span id="1L" class="Ln"><a href="debug.hpp.html"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">"debug.hpp"</span></a></span>
<span id="2L" class="Ln"><a href="cgWrappers.hpp.html"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">"cgWrappers.hpp"</span></a></span>
<span id="3L" class="Ln"><a href="CgStr.hpp.html"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">"CgStr.hpp"</span></a></span>
<span id="4L" class="Ln"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">&lt;</span><span class="cpf">cstdlib</span><span class="cpf">></span></span>
<span id="5L" class="Ln"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">&lt;</span><span class="cpf">cstring</span><span class="cpf">></span></span>
<span id="6L" class="Ln"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">&lt;</span><span class="cpf">iostream</span><span class="cpf">></span></span>
<span id="7L" class="Ln"></span>
<span id="8L" class="Ln"><span class="kd">using</span> <span class="kd">namespace</span> <a href="debug.hpp.html#synth" class="nn">synth</a>;</span>
<span id="9L" class="Ln"></span>
<span id="10L" class="Ln"><span class="kd">static</span> <span class="kt">char</span> <span class="kd">const</span><span class="p">*</span> <span class="kd">const</span> <span class="def decl vg" id="kLinkageSpellings">kLinkageSpellings</span><span class="p">[</span><span class="p">]</span> <span class="p">=</span> <span class="p">{</span></span>
<span id="11L" class="Ln">    <span class="s">"Invalid"</span><span class="p">,</span></span>
<span id="12L" class="Ln">    <span class="s">"NoLinkage"</span><span class="p">,</span></span>
<span id="13L" class="Ln">    <span class="s">"Internal"</span><span class="p">,</span></span>
<span id="14L" class="Ln">    <span class="s">"UniqueExternal"</span><span class="p">,</span></span>
<span id="15L" class="Ln">    <span class="s">"External"</span></span>
<span id="16L" class="Ln"><span class="p">}</span>;</span>
<span id="17L" class="Ln"><span class="kd">static</span> <span class="kt">char</span> <span class="kd">const</span><span class="p">*</span> <span class="kd">const</span> <span class="def decl vg" id="kLangSpellings">kLangSpellings</span><span class="p">[</span><span class="p">]</span> <span class="p">=</span> <span class="p">{</span></span>
<span id="18L" class="Ln">    <span class="s">"Invalid"</span><span class="p">,</span></span>
<span id="19L" class="Ln">    <span class="s">"C"</span><span class="p">,</span></span>
<span id="20L" class="Ln">    <span class="s">"ObjC"</span><span class="p">,</span></span>
<span id="21L" class="Ln">    <span class="s">"C++"</span></span>
<span id="22L" class="Ln"><span class="p">}</span>;</span>
<span id="23L" class="Ln"></span>
<span id="24L" class="Ln"><span class="c">// Returns decl</span></span>
<span id="25L" class="Ln"><span class="kd">static</span> <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/utility/pair" class="nc">pair</a><span class="p">&lt;</span><a href="../lib-llvm/include/clang-c/Index.h.html#2985L" class="nc">CXType</a><span class="p">,</span> <a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="nc">CXCursor</a><span class="p">></span> <span class="def decl nf" id="dumpType:CXType,CXCursor">dumpType</span><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#2985L" class="nc">CXType</a> <span class="def decl nv">ty</span><span class="p">,</span> <a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="nc">CXCursor</a> <span class="def decl nv">ref</span><span class="p">)</span></span>
<span id="26L" class="Ln"><span class="p">{</span></span>
<span id="27L" class="Ln"></span>
<span id="28L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="#25L" class="nv">ty</a><span class="p">.</span><a href="../lib-llvm/include/clang-c/Index.h.html#CXType::kind" class="vi">kind</a> <span class="o">==</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXTypeKind::CXType_Invalid" class="no">CXType_Invalid</a><span class="p">)</span> <span class="p">{</span></span>
<span id="29L" class="Ln">        <span class="k">return</span> <span class="p">{</span></span>
<span id="30L" class="Ln">            <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getCursorType:CXCursor" class="nf">clang_getCursorType</a><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_getNullCursor" class="nf">clang_getNullCursor</a><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">,</span></span>
<span id="31L" class="Ln">            <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getNullCursor" class="nf">clang_getNullCursor</a><span class="p">(</span><span class="p">)</span></span>
<span id="32L" class="Ln">        <span class="p">}</span><span class="p">;</span></span>
<span id="33L" class="Ln">    <span class="p">}</span></span>
<span id="34L" class="Ln">    <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">clog</a> <a href="CgStr.hpp.html#synth::operator<<:std::ostream&amp;,const-synth::CgStr&amp;" class="p">&lt;&lt;</a> <a href="CgStr.hpp.html#synth::CgStr" class="nc">CgStr</a><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_getTypeKindSpelling:enum-CXTypeKind" class="nf">clang_getTypeKindSpelling</a><span class="p">(</span><a href="#25L" class="nv">ty</a><span class="p">.</span><a href="../lib-llvm/include/clang-c/Index.h.html#CXType::kind" class="vi">kind</a><span class="p">)</span><span class="p">)</span></span>
<span id="35L" class="Ln">        <span class="p">&lt;&lt;</span> <span class="sc">' '</span> <a href="CgStr.hpp.html#synth::operator<<:std::ostream&amp;,const-synth::CgStr&amp;" class="p">&lt;&lt;</a> <a href="CgStr.hpp.html#synth::CgStr" class="nc">CgStr</a><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_getTypeSpelling:CXType" class="nf">clang_getTypeSpelling</a><span class="p">(</span><a href="#25L" class="nv">ty</a><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="36L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="nc">CXCursor</a> <span class="def decl nv">decl</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getTypeDeclaration:CXType" class="nf">clang_getTypeDeclaration</a><span class="p">(</span><a href="#25L" class="nv">ty</a><span class="p">)</span><span class="p">;</span></span>
<span id="37L" class="Ln">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_equalCursors:CXCursor,CXCursor" class="nf">clang_equalCursors</a><span class="p">(</span><a href="#25L" class="nv">ref</a><span class="p">,</span> <a href="#36L" class="nv">decl</a><span class="p">)</span><span class="p">)</span></span>
<span id="38L" class="Ln">        <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">clog</a> <span class="p">&lt;&lt;</span> <span class="s">" @ "</span> <a href="debug.hpp.html#synth::operator<<:std::ostream&amp;,CXCursor" class="p">&lt;&lt;</a> <a href="#36L" class="nv">decl</a><span class="p">;</span></span>
<span id="39L" class="Ln">    <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">clog</a> <span class="p">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span></span>
<span id="40L" class="Ln">    <span class="k">return</span> <span class="p">{</span><a href="#25L" class="nv">ty</a><span class="p">,</span> <a href="#36L" class="nv">decl</a><span class="p">}</span><span class="p">;</span></span>
<span id="41L" class="Ln"><span class="p">}</span></span>
<span id="42L" class="Ln"></span>
<span id="43L" class="Ln"><span class="kd">static</span> <span class="kt">void</span> <span class="def decl nf" id="dumpAnnotatedToken:CXTranslationUnit,CXToken,CXCursor,bool,CXFile">dumpAnnotatedToken</span><span class="p">(</span></span>
<span id="44L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#CXTranslationUnit" class="nc">CXTranslationUnit</a> <span class="def decl nv">tu</span><span class="p">,</span></span>
<span id="45L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#4250L" class="nc">CXToken</a> <span class="def decl nv">tok</span><span class="p">,</span></span>
<span id="46L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="nc">CXCursor</a> <span class="def decl nv">cur</span><span class="p">,</span></span>
<span id="47L" class="Ln">    <span class="kt">bool</span> <span class="def decl nv">extrainfo</span><span class="p">,</span></span>
<span id="48L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#CXFile" class="nc">CXFile</a> <span class="def decl nv">f</span> <span class="p">=</span> <span class="kc">nullptr</span><span class="p">)</span></span>
<span id="49L" class="Ln"><span class="p">{</span></span>
<span id="50L" class="Ln">    <a href="debug.hpp.html#synth::writeToken:std::ostream&amp;,CXToken,CXTranslationUnit,CXFile" class="nf">writeToken</a><span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">clog</a><span class="p">,</span> <a href="#45L" class="nv">tok</a><span class="p">,</span> <a href="#44L" class="nv">tu</a><span class="p">,</span> <a href="#48L" class="nv">f</a><span class="p">)</span><span class="p">;</span></span>
<span id="51L" class="Ln">    <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">clog</a> <span class="p">&lt;&lt;</span> <span class="sc">'\t'</span><span class="p">;</span></span>
<span id="52L" class="Ln">    <a href="debug.hpp.html#synth::dumpSingleCursor:CXCursor,int,CXFile" class="nf">dumpSingleCursor</a><span class="p">(</span><a href="#46L" class="nv">cur</a><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <a href="#48L" class="nv">f</a><span class="p">)</span><span class="p">;</span></span>
<span id="53L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="#47L" class="nv">extrainfo</a><span class="p">)</span> <span class="p">{</span></span>
<span id="54L" class="Ln">        <a href="CgStr.hpp.html#synth::CgStr" class="nc">CgStr</a> <span class="def decl nv">usr</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getCursorUSR:CXCursor" class="nf">clang_getCursorUSR</a><span class="p">(</span><a href="#46L" class="nv">cur</a><span class="p">)</span><span class="p">;</span></span>
<span id="55L" class="Ln">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><a href="#54L" class="nv">usr</a><span class="p">.</span><a href="CgStr.hpp.html#synth::CgStr::empty" class="nf">empty</a><span class="p">(</span><span class="p">)</span><span class="p">)</span></span>
<span id="56L" class="Ln">            <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">clog</a> <span class="p">&lt;&lt;</span> <span class="s">"    U: "</span> <a href="CgStr.hpp.html#synth::operator<<:std::ostream&amp;,const-synth::CgStr&amp;" class="p">&lt;&lt;</a> <a href="#54L" class="nv">usr</a> <span class="p">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span></span>
<span id="57L" class="Ln">        <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">clog</a> <span class="p">&lt;&lt;</span> <span class="s">"    T: "</span><span class="p">;</span></span>
<span id="58L" class="Ln">        <span class="kd">auto</span> <span class="def decl nv">tyWithDecl</span> <span class="p">=</span> <a href="#dumpType:CXType,CXCursor" class="nf">dumpType</a><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_getCursorType:CXCursor" class="nf">clang_getCursorType</a><span class="p">(</span><a href="#46L" class="nv">cur</a><span class="p">)</span><span class="p">,</span> <a href="#46L" class="nv">cur</a><span class="p">)</span><span class="p">;</span></span>
<span id="59L" class="Ln">        <a href="../lib-llvm/include/clang-c/Index.h.html#2985L" class="nc">CXType</a> <span class="def decl nv">canonTy</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getCanonicalType:CXType" class="nf">clang_getCanonicalType</a><span class="p">(</span><a href="#58L" class="nv">tyWithDecl</a><span class="p">.</span><span class="vi">first</span><span class="p">)</span><span class="p">;</span></span>
<span id="60L" class="Ln">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_equalTypes:CXType,CXType" class="nf">clang_equalTypes</a><span class="p">(</span><a href="#58L" class="nv">tyWithDecl</a><span class="p">.</span><span class="vi">first</span><span class="p">,</span> <a href="#59L" class="nv">canonTy</a><span class="p">)</span><span class="p">)</span> <span class="p">{</span></span>
<span id="61L" class="Ln">            <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">clog</a> <span class="p">&lt;&lt;</span> <span class="s">"    CT: "</span><span class="p">;</span></span>
<span id="62L" class="Ln">            <a href="#dumpType:CXType,CXCursor" class="nf">dumpType</a><span class="p">(</span><a href="#59L" class="nv">canonTy</a><span class="p">,</span> <a href="#58L" class="nv">tyWithDecl</a><span class="p">.</span><span class="vi">second</span><span class="p">)</span><span class="p">;</span></span>
<span id="63L" class="Ln">        <span class="p">}</span></span>
<span id="64L" class="Ln">        <a href="../lib-llvm/include/clang-c/Index.h.html#CXLinkageKind" class="nc">CXLinkageKind</a> <span class="def decl nv">linkage</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getCursorLinkage:CXCursor" class="nf">clang_getCursorLinkage</a><span class="p">(</span><a href="#46L" class="nv">cur</a><span class="p">)</span><span class="p">;</span></span>
<span id="65L" class="Ln">        <span class="k">if</span> <span class="p">(</span><a href="#64L" class="nv">linkage</a> <span class="o">!=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXLinkageKind::CXLinkage_Invalid" class="no">CXLinkage_Invalid</a><span class="p">)</span></span>
<span id="66L" class="Ln">            <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">clog</a> <span class="p">&lt;&lt;</span> <span class="s">"    Lnk: "</span> <span class="p">&lt;&lt;</span> <a href="#kLinkageSpellings" class="vg">kLinkageSpellings</a><span class="p">[</span><a href="#64L" class="nv">linkage</a><span class="p">]</span><span class="p">;</span></span>
<span id="67L" class="Ln">        <a href="../lib-llvm/include/clang-c/Index.h.html#CXLanguageKind" class="nc">CXLanguageKind</a> <span class="def decl nv">lang</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getCursorLanguage:CXCursor" class="nf">clang_getCursorLanguage</a><span class="p">(</span><a href="#46L" class="nv">cur</a><span class="p">)</span><span class="p">;</span></span>
<span id="68L" class="Ln">        <span class="k">if</span> <span class="p">(</span><a href="#67L" class="nv">lang</a> <span class="o">!=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXLanguageKind::CXLanguage_Invalid" class="no">CXLanguage_Invalid</a><span class="p">)</span></span>
<span id="69L" class="Ln">            <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">clog</a> <span class="p">&lt;&lt;</span> <span class="s">"   Lng: "</span> <span class="p">&lt;&lt;</span> <a href="#kLangSpellings" class="vg">kLangSpellings</a><span class="p">[</span><a href="#67L" class="nv">lang</a><span class="p">]</span><span class="p">;</span></span>
<span id="70L" class="Ln">        <span class="k">if</span> <span class="p">(</span><a href="#67L" class="nv">lang</a> <span class="o">!=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXLanguageKind::CXLanguage_Invalid" class="no">CXLanguage_Invalid</a> <span class="o">||</span> <a href="#64L" class="nv">linkage</a> <span class="o">!=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXLinkageKind::CXLinkage_Invalid" class="no">CXLinkage_Invalid</a><span class="p">)</span></span>
<span id="71L" class="Ln">            <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">clog</a> <span class="p">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span></span>
<span id="72L" class="Ln">        <a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="nc">CXCursor</a> <span class="def decl nv">canon</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getCanonicalCursor:CXCursor" class="nf">clang_getCanonicalCursor</a><span class="p">(</span><a href="#46L" class="nv">cur</a><span class="p">)</span><span class="p">;</span></span>
<span id="73L" class="Ln">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_equalCursors:CXCursor,CXCursor" class="nf">clang_equalCursors</a><span class="p">(</span><a href="#46L" class="nv">cur</a><span class="p">,</span> <a href="#72L" class="nv">canon</a><span class="p">)</span><span class="p">)</span></span>
<span id="74L" class="Ln">            <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">clog</a> <span class="p">&lt;&lt;</span> <span class="s">"    Can: "</span> <a href="debug.hpp.html#synth::operator<<:std::ostream&amp;,CXCursor" class="p">&lt;&lt;</a> <a href="#72L" class="nv">canon</a> <span class="p">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span></span>
<span id="75L" class="Ln">        <a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="nc">CXCursor</a> <span class="def decl nv">def</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getCursorDefinition:CXCursor" class="nf">clang_getCursorDefinition</a><span class="p">(</span><a href="#46L" class="nv">cur</a><span class="p">)</span><span class="p">;</span></span>
<span id="76L" class="Ln">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_equalCursors:CXCursor,CXCursor" class="nf">clang_equalCursors</a><span class="p">(</span><a href="#46L" class="nv">cur</a><span class="p">,</span> <a href="#75L" class="nv">def</a><span class="p">)</span><span class="p">)</span></span>
<span id="77L" class="Ln">            <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">clog</a> <span class="p">&lt;&lt;</span> <span class="s">"    Def: "</span> <a href="debug.hpp.html#synth::operator<<:std::ostream&amp;,CXCursor" class="p">&lt;&lt;</a> <a href="#75L" class="nv">def</a> <span class="p">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span></span>
<span id="78L" class="Ln">    <span class="p">}</span></span>
<span id="79L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="nc">CXCursor</a> <span class="def decl nv">c2</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getCursor:CXTranslationUnit,CXSourceLocation" class="nf">clang_getCursor</a><span class="p">(</span><a href="#44L" class="nv">tu</a><span class="p">,</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getTokenLocation:CXTranslationUnit,CXToken" class="nf">clang_getTokenLocation</a><span class="p">(</span><a href="#44L" class="nv">tu</a><span class="p">,</span> <a href="#45L" class="nv">tok</a><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="80L" class="Ln">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_equalCursors:CXCursor,CXCursor" class="nf">clang_equalCursors</a><span class="p">(</span><a href="#46L" class="nv">cur</a><span class="p">,</span> <a href="#79L" class="nv">c2</a><span class="p">)</span><span class="p">)</span></span>
<span id="81L" class="Ln">        <a href="debug.hpp.html#synth::dumpSingleCursor:CXCursor,int,CXFile" class="nf">dumpSingleCursor</a><span class="p">(</span><a href="#79L" class="nv">c2</a><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <a href="#48L" class="nv">f</a><span class="p">)</span><span class="p">;</span></span>
<span id="82L" class="Ln"><span class="p">}</span></span>
<span id="83L" class="Ln"></span>
<span id="84L" class="Ln"><span class="kd">static</span> <span class="kt">void</span> <span class="def decl nf" id="dumpTokens:CXCursor,bool,bool">dumpTokens</span><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="nc">CXCursor</a> <span class="def decl nv">root</span><span class="p">,</span> <span class="kt">bool</span> <span class="def decl nv">annotate</span><span class="p">,</span> <span class="kt">bool</span> <span class="def decl nv">extrainfo</span><span class="p">)</span></span>
<span id="85L" class="Ln"><span class="p">{</span></span>
<span id="86L" class="Ln">    <span class="c">// TODO: Duplicate from annotate.cpp processFile()</span></span>
<span id="87L" class="Ln"></span>
<span id="88L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#CXTranslationUnit" class="nc">CXTranslationUnit</a> <span class="def decl nv">tu</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_Cursor_getTranslationUnit:CXCursor" class="nf">clang_Cursor_getTranslationUnit</a><span class="p">(</span><a href="#84L" class="nv">root</a><span class="p">)</span><span class="p">;</span></span>
<span id="89L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#4250L" class="nc">CXToken</a><span class="p">*</span> <span class="def decl nv">tokens</span><span class="p">;</span></span>
<span id="90L" class="Ln">    <span class="kt">unsigned</span> <span class="def decl nv">numTokens</span><span class="p">;</span></span>
<span id="91L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#378L" class="nc">CXSourceRange</a> <span class="def decl nv">rng</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getCursorExtent:CXCursor" class="nf">clang_getCursorExtent</a><span class="p">(</span><a href="#84L" class="nv">root</a><span class="p">)</span><span class="p">;</span></span>
<span id="92L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#clang_tokenize:CXTranslationUnit,CXSourceRange,CXToken**,unsigned-int*" class="nf">clang_tokenize</a><span class="p">(</span><a href="#88L" class="nv">tu</a><span class="p">,</span> <a href="#91L" class="nv">rng</a><span class="p">,</span> <span class="o">&amp;</span><a href="#89L" class="nv">tokens</a><span class="p">,</span> <span class="o">&amp;</span><a href="#90L" class="nv">numTokens</a><span class="p">)</span><span class="p">;</span></span>
<span id="93L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#CXFile" class="nc">CXFile</a> <span class="def decl nv">f</span><span class="p">;</span></span>
<span id="94L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getFileLocation:CXSourceLocation,CXFile*,unsigned-int*,unsigned-int*,unsigned-int*" class="nf">clang_getFileLocation</a><span class="p">(</span></span>
<span id="95L" class="Ln">        <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getRangeStart:CXSourceRange" class="nf">clang_getRangeStart</a><span class="p">(</span><a href="#91L" class="nv">rng</a><span class="p">)</span><span class="p">,</span> <span class="o">&amp;</span><a href="#93L" class="nv">f</a><span class="p">,</span> <span class="kc">nullptr</span><span class="p">,</span> <span class="kc">nullptr</span><span class="p">,</span> <span class="kc">nullptr</span><span class="p">)</span><span class="p">;</span></span>
<span id="96L" class="Ln"></span>
<span id="97L" class="Ln">    <a href="cgWrappers.hpp.html#synth::CgTokensHandle" class="nc">CgTokensHandle</a> <span class="def decl nv">tokCleanup</span><span class="p">(</span><a href="#89L" class="nv">tokens</a><span class="p">,</span> <a href="#90L" class="nv">numTokens</a><span class="p">,</span> <a href="#88L" class="nv">tu</a><span class="p">)</span><span class="p">;</span></span>
<span id="98L" class="Ln"></span>
<span id="99L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="#90L" class="nv">numTokens</a> <span class="o">></span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span></span>
<span id="100L" class="Ln">        <span class="k">if</span> <span class="p">(</span><a href="#84L" class="nv">annotate</a><span class="p">)</span> <span class="p">{</span></span>
<span id="101L" class="Ln">            <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/container/vector" class="nc">vector</a><span class="p">&lt;</span><a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="nc">CXCursor</a><span class="p">></span> <span class="def decl nv">tokCurs</span><span class="p">(</span><a href="#90L" class="nv">numTokens</a><span class="p">)</span><span class="p">;</span></span>
<span id="102L" class="Ln">            <a href="../lib-llvm/include/clang-c/Index.h.html#clang_annotateTokens:CXTranslationUnit,CXToken*,unsigned-int,CXCursor*" class="nf">clang_annotateTokens</a><span class="p">(</span><a href="#88L" class="nv">tu</a><span class="p">,</span> <a href="#89L" class="nv">tokens</a><span class="p">,</span> <a href="#90L" class="nv">numTokens</a><span class="p">,</span> <a href="#101L" class="nv">tokCurs</a><span class="p">.</span><span class="nf">data</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="103L" class="Ln">            <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="def decl nv">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <a href="#103L" class="nv">i</a> <span class="o">&lt;</span> <a href="#90L" class="nv">numTokens</a><span class="p">;</span> <span class="o">++</span><a href="#103L" class="nv">i</a><span class="p">)</span> <span class="p">{</span></span>
<span id="104L" class="Ln">                <a href="../lib-llvm/include/clang-c/Index.h.html#2385L" class="nc">CXCursor</a> <span class="def decl nv">cur</span> <span class="p">=</span> <a href="#101L" class="nv">tokCurs</a><span class="p">[</span><a href="#103L" class="nv">i</a><span class="p">]</span><span class="p">;</span></span>
<span id="105L" class="Ln">                <a href="#dumpAnnotatedToken:CXTranslationUnit,CXToken,CXCursor,bool,CXFile" class="nf">dumpAnnotatedToken</a><span class="p">(</span><a href="#88L" class="nv">tu</a><span class="p">,</span> <a href="#89L" class="nv">tokens</a><span class="p">[</span><a href="#103L" class="nv">i</a><span class="p">]</span><span class="p">,</span> <a href="#104L" class="nv">cur</a><span class="p">,</span> <a href="#84L" class="nv">extrainfo</a><span class="p">,</span> <a href="#93L" class="nv">f</a><span class="p">)</span><span class="p">;</span></span>
<span id="106L" class="Ln">            <span class="p">}</span></span>
<span id="107L" class="Ln">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></span>
<span id="108L" class="Ln">            <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="def decl nv">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <a href="#108L" class="nv">i</a> <span class="o">&lt;</span> <a href="#90L" class="nv">numTokens</a><span class="p">;</span> <span class="o">++</span><a href="#108L" class="nv">i</a><span class="p">)</span> <span class="p">{</span></span>
<span id="109L" class="Ln">                <a href="debug.hpp.html#synth::writeToken:std::ostream&amp;,CXToken,CXTranslationUnit,CXFile" class="nf">writeToken</a><span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">clog</a><span class="p">,</span> <a href="#89L" class="nv">tokens</a><span class="p">[</span><a href="#108L" class="nv">i</a><span class="p">]</span><span class="p">,</span> <a href="#88L" class="nv">tu</a><span class="p">,</span> <a href="#93L" class="nv">f</a><span class="p">)</span><span class="p">;</span></span>
<span id="110L" class="Ln">                <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">clog</a> <span class="p">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span></span>
<span id="111L" class="Ln">            <span class="p">}</span></span>
<span id="112L" class="Ln">        <span class="p">}</span></span>
<span id="113L" class="Ln">    <span class="p">}</span></span>
<span id="114L" class="Ln"><span class="p">}</span></span>
<span id="115L" class="Ln"></span>
<span id="116L" class="Ln"><span class="kt">int</span> <span class="def decl nf" id="main:int,char*[]">main</span><span class="p">(</span><span class="kt">int</span> <span class="def decl nv">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="p">*</span><span class="def decl nv">argv</span><span class="p">[</span><span class="p">]</span><span class="p">)</span></span>
<span id="117L" class="Ln"><span class="p">{</span></span>
<span id="118L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="#116L" class="nv">argc</a> <span class="o">&lt;</span> <span class="m">3</span><span class="p">)</span> <span class="p">{</span></span>
<span id="119L" class="Ln">        <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">cerr</a> <span class="p">&lt;&lt;</span> <span class="s">"Usage: "</span> <span class="p">&lt;&lt;</span> <a href="#116L" class="nv">argv</a><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">&lt;&lt;</span> <span class="s">" &lt;flags> &lt;clang-cmd>\n"</span><span class="p">;</span></span>
<span id="120L" class="Ln">        <span class="k">return</span> <span class="cp">EXIT_FAILURE</span><span class="p">;</span></span>
<span id="121L" class="Ln">    <span class="p">}</span></span>
<span id="122L" class="Ln"></span>
<span id="123L" class="Ln">    <a href="cgWrappers.hpp.html#synth::CgIdxHandle" class="nc">CgIdxHandle</a> <span class="def decl nv">hcidx</span><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_createIndex:int,int" class="nf">clang_createIndex</a><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="124L" class="Ln"></span>
<span id="125L" class="Ln">    <span class="c">// TODO: Duplicated from annotate.cpp synth::processTu() {{{</span></span>
<span id="126L" class="Ln">    <a href="../lib-llvm/include/clang-c/Index.h.html#CXTranslationUnit" class="nc">CXTranslationUnit</a> <span class="def decl nv">tu</span> <span class="p">=</span> <span class="kc">nullptr</span><span class="p">;</span></span>
<span id="127L" class="Ln">    <span class="kt">unsigned</span> <span class="def decl nv">options</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span></span>
<span id="128L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">strchr</span><span class="p">(</span><a href="#116L" class="nv">argv</a><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="p">,</span> <span class="sc">'p'</span><span class="p">)</span><span class="p">)</span></span>
<span id="129L" class="Ln">        <a href="#127L" class="nv">options</a> <span class="p">|=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#CXTranslationUnit_Flags::CXTranslationUnit_DetailedPreprocessingRecord" class="no">CXTranslationUnit_DetailedPreprocessingRecord</a><span class="p">;</span></span>
<span id="130L" class="Ln"></span>
<span id="131L" class="Ln">    <a href="../lib-llvm/include/clang-c/CXErrorCode.h.html#CXErrorCode" class="nc">CXErrorCode</a> <span class="def decl nv">err</span> <span class="p">=</span> <a href="../lib-llvm/include/clang-c/Index.h.html#1313L" class="nf">clang_parseTranslationUnit2FullArgv</a><span class="p">(</span></span>
<span id="132L" class="Ln">        <a href="#123L" class="nv">hcidx</a><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="p">)</span><span class="p">,</span></span>
<span id="133L" class="Ln">        <span class="c">/*source_filename:*/</span> <span class="kc">nullptr</span><span class="p">,</span> <span class="c">// Included in commandline.</span></span>
<span id="134L" class="Ln">        <a href="#116L" class="nv">argv</a> <span class="o">+</span> <span class="m">2</span><span class="p">,</span></span>
<span id="135L" class="Ln">        <a href="#116L" class="nv">argc</a> <span class="o">-</span> <span class="m">2</span><span class="p">,</span></span>
<span id="136L" class="Ln">        <span class="c">/*unsaved_files:*/</span> <span class="kc">nullptr</span><span class="p">,</span></span>
<span id="137L" class="Ln">        <span class="c">/*num_unsaved_files:*/</span> <span class="m">0</span><span class="p">,</span></span>
<span id="138L" class="Ln">        <a href="#127L" class="nv">options</a><span class="p">,</span></span>
<span id="139L" class="Ln">        <span class="o">&amp;</span><a href="#126L" class="nv">tu</a><span class="p">)</span><span class="p">;</span></span>
<span id="140L" class="Ln">    <a href="cgWrappers.hpp.html#synth::CgTuHandle" class="nc">CgTuHandle</a> <span class="def decl nv">htu</span><span class="p">(</span><a href="#126L" class="nv">tu</a><span class="p">)</span><span class="p">;</span></span>
<span id="141L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="#131L" class="nv">err</a> <span class="o">!=</span> <a href="../lib-llvm/include/clang-c/CXErrorCode.h.html#CXErrorCode::CXError_Success" class="no">CXError_Success</a><span class="p">)</span> <span class="p">{</span></span>
<span id="142L" class="Ln">        <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="vg">cerr</a> <span class="p">&lt;&lt;</span> <span class="s">"Failed parsing translation unit (code "</span></span>
<span id="143L" class="Ln">                  <span class="p">&lt;&lt;</span> <span class="k">static_cast</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">></span><span class="p">(</span><a href="#131L" class="nv">err</a><span class="p">)</span></span>
<span id="144L" class="Ln">                  <span class="p">&lt;&lt;</span> <span class="s">")\n"</span><span class="p">;</span></span>
<span id="145L" class="Ln">        <span class="k">return</span> <a href="#131L" class="nv">err</a> <span class="o">+</span> <span class="m">10</span><span class="p">;</span></span>
<span id="146L" class="Ln">    <span class="p">}</span></span>
<span id="147L" class="Ln">    <span class="c">// }}}</span></span>
<span id="148L" class="Ln"></span>
<span id="149L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">strchr</span><span class="p">(</span><a href="#116L" class="nv">argv</a><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="p">,</span> <span class="sc">'a'</span><span class="p">)</span><span class="p">)</span></span>
<span id="150L" class="Ln">        <a href="debug.hpp.html#synth::dumpAst:CXCursor,int" class="nf">dumpAst</a><span class="p">(</span><a href="../lib-llvm/include/clang-c/Index.h.html#clang_getTranslationUnitCursor:CXTranslationUnit" class="nf">clang_getTranslationUnitCursor</a><span class="p">(</span><a href="#126L" class="nv">tu</a><span class="p">)</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span><span class="p">;</span></span>
<span id="151L" class="Ln"></span>
<span id="152L" class="Ln">    <span class="k">if</span> <span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">strchr</span><span class="p">(</span><a href="#116L" class="nv">argv</a><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="p">,</span> <span class="sc">'t'</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span></span>
<span id="153L" class="Ln">        <a href="#dumpTokens:CXCursor,bool,bool" class="nf">dumpTokens</a><span class="p">(</span></span>
<span id="154L" class="Ln">            <a href="../lib-llvm/include/clang-c/Index.h.html#clang_getTranslationUnitCursor:CXTranslationUnit" class="nf">clang_getTranslationUnitCursor</a><span class="p">(</span><a href="#126L" class="nv">tu</a><span class="p">)</span><span class="p">,</span></span>
<span id="155L" class="Ln">            <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">strchr</span><span class="p">(</span><a href="#116L" class="nv">argv</a><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="p">,</span> <span class="sc">'c'</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">nullptr</span><span class="p">,</span></span>
<span id="156L" class="Ln">            <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><span class="nf">strchr</span><span class="p">(</span><a href="#116L" class="nv">argv</a><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="p">,</span> <span class="sc">'x'</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">nullptr</span><span class="p">)</span><span class="p">;</span></span>
<span id="157L" class="Ln">    <span class="p">}</span></span>
<span id="158L" class="Ln"></span>
<span id="159L" class="Ln">    <span class="k">return</span> <span class="m">0</span><span class="p">;</span></span>
<span id="160L" class="Ln"><span class="p">}</span></span>
<span id="161L" class="Ln"></span>
</pre></div>
        <script src="../code.js"></script>
    </body>
</html>
