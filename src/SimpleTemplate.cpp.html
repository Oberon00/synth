<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>src/SimpleTemplate.cpp</title>
        <link rel="stylesheet" href="../codestyle-colorful.css">
    </head>
    <body>
        <div class="highlight"><pre><span id="1L" class="Ln"><a href="SimpleTemplate.hpp.html"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">"SimpleTemplate.hpp"</span></a></span>
<span id="2L" class="Ln"></span>
<span id="3L" class="Ln"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">&lt;</span><span class="cpf">boost</span><span class="cpf">/</span><span class="cpf">variant</span><span class="cpf">/</span><span class="cpf">apply_visitor</span><span class="cpf">.</span><span class="cpf">hpp</span><span class="cpf">></span></span>
<span id="4L" class="Ln"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">&lt;</span><span class="cpf">boost</span><span class="cpf">/</span><span class="cpf">variant</span><span class="cpf">/</span><span class="cpf">variant</span><span class="cpf">.</span><span class="cpf">hpp</span><span class="cpf">></span></span>
<span id="5L" class="Ln"></span>
<span id="6L" class="Ln"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">&lt;</span><span class="cpf">cassert</span><span class="cpf">></span></span>
<span id="7L" class="Ln"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">&lt;</span><span class="cpf">ostream</span><span class="cpf">></span></span>
<span id="8L" class="Ln"></span>
<span id="9L" class="Ln"><span class="kd">using</span> <span class="kd">namespace</span> <a href="SimpleTemplate.hpp.html#synth" class="nn">synth</a>;</span>
<span id="10L" class="Ln"></span>
<span id="11L" class="Ln"><a href="SimpleTemplate.hpp.html#synth::SimpleTemplate" class="nc">SimpleTemplate</a><span class="p">::</span><span class="def decl nf" id="synth::SimpleTemplate::SimpleTemplate:boost::string_ref">SimpleTemplate</span><span class="p">(</span><span class="nn">boost</span><span class="p">::</span><span class="nc">string_ref</span> <span class="def decl nv">text</span><span class="p">)</span></span>
<span id="12L" class="Ln"><span class="p">{</span></span>
<span id="13L" class="Ln">    <span class="kd">static</span> <span class="kt">char</span> <span class="kd">const</span> <span class="def decl nv">rawMarker</span><span class="p">[</span><span class="p">]</span> <span class="p">=</span> <span class="s">"@@"</span><span class="p">;</span></span>
<span id="14L" class="Ln">    <span class="kd">static</span> <span class="nn">boost</span><span class="p">::</span><span class="nc">string_ref</span> <span class="kd">const</span> <span class="def decl nv">marker</span><span class="p">(</span><a href="#13L" class="nv">rawMarker</a><span class="p">,</span> <span class="ow">sizeof</span><span class="p">(</span><a href="#13L" class="nv">rawMarker</a><span class="p">)</span> <span class="o">-</span> <span class="m">1</span><span class="p">)</span><span class="p">;</span></span>
<span id="15L" class="Ln"></span>
<span id="16L" class="Ln">    <span class="kd">auto</span> <span class="def decl nv">beg</span> <span class="p">=</span> <a href="#11L" class="nv">text</a><span class="p">.</span><span class="nf">find</span><span class="p">(</span><a href="#14L" class="nv">marker</a><span class="p">)</span><span class="p">;</span></span>
<span id="17L" class="Ln">    <span class="k">while</span> <span class="p">(</span><a href="#16L" class="nv">beg</a> <span class="o">!=</span> <span class="nn">boost</span><span class="p">::</span><span class="nc">string_ref</span><span class="p">::</span><span class="vc">npos</span><span class="p">)</span> <span class="p">{</span></span>
<span id="18L" class="Ln">        <a href="SimpleTemplate.hpp.html#synth::SimpleTemplate::m_literals" class="vi">m_literals</a><span class="p">.</span><span class="nf">emplace_back</span><span class="p">(</span><a href="#11L" class="nv">text</a><span class="p">.</span><span class="nf">data</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <a href="#16L" class="nv">beg</a><span class="p">)</span><span class="p">;</span></span>
<span id="19L" class="Ln">        <a href="#11L" class="nv">text</a><span class="p">.</span><span class="nf">remove_prefix</span><span class="p">(</span><a href="#16L" class="nv">beg</a> <span class="o">+</span> <a href="#14L" class="nv">marker</a><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="20L" class="Ln">        <span class="kd">auto</span> <span class="def decl nv">end</span> <span class="p">=</span> <a href="#11L" class="nv">text</a><span class="p">.</span><span class="nf">find</span><span class="p">(</span><a href="#14L" class="nv">marker</a><span class="p">)</span><span class="p">;</span></span>
<span id="21L" class="Ln">        <span class="k">if</span> <span class="p">(</span><a href="#20L" class="nv">end</a> <span class="o">==</span> <span class="nn">boost</span><span class="p">::</span><span class="nc">string_ref</span><span class="p">::</span><span class="vc">npos</span><span class="p">)</span> <span class="p">{</span></span>
<span id="22L" class="Ln">            <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/string/basic_string" class="nc">string</a><span class="p">&amp;</span> <span class="def decl nv">lit</span> <span class="p">=</span> <a href="SimpleTemplate.hpp.html#synth::SimpleTemplate::m_literals" class="vi">m_literals</a><span class="p">.</span><span class="nf">back</span><span class="p">(</span><span class="p">)</span><span class="p">;</span></span>
<span id="23L" class="Ln">            <a href="#22L" class="nv">lit</a><span class="p">.</span><span class="nf">reserve</span><span class="p">(</span><a href="#22L" class="nv">lit</a><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="p">)</span> <span class="o">+</span> <a href="#14L" class="nv">marker</a><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="p">)</span> <span class="o">+</span> <a href="#11L" class="nv">text</a><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="24L" class="Ln">            <a href="#22L" class="nv">lit</a><span class="p">.</span><span class="nf">append</span><span class="p">(</span><a href="#14L" class="nv">marker</a><span class="p">.</span><span class="nf">data</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <a href="#14L" class="nv">marker</a><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="25L" class="Ln">            <a href="#22L" class="nv">lit</a><span class="p">.</span><span class="nf">append</span><span class="p">(</span><a href="#11L" class="nv">text</a><span class="p">.</span><span class="nf">data</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <a href="#11L" class="nv">text</a><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="26L" class="Ln">            <span class="cp">assert</span>(<a href="SimpleTemplate.hpp.html#synth::SimpleTemplate::m_literals" class="vi">m_literals</a><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="p">)</span> <span class="p">==</span> <a href="SimpleTemplate.hpp.html#synth::SimpleTemplate::m_insertionKeys" class="vi">m_insertionKeys</a><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="p">)</span> <span class="p">+</span> <span class="m">1</span>)<span class="p">;</span></span>
<span id="27L" class="Ln">            <span class="k">return</span><span class="p">;</span></span>
<span id="28L" class="Ln">        <span class="p">}</span></span>
<span id="29L" class="Ln">        <a href="SimpleTemplate.hpp.html#synth::SimpleTemplate::m_insertionKeys" class="vi">m_insertionKeys</a><span class="p">.</span><span class="nf">emplace_back</span><span class="p">(</span><a href="#11L" class="nv">text</a><span class="p">.</span><span class="nf">data</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <a href="#20L" class="nv">end</a><span class="p">)</span><span class="p">;</span></span>
<span id="30L" class="Ln">        <a href="#11L" class="nv">text</a><span class="p">.</span><span class="nf">remove_prefix</span><span class="p">(</span><a href="#20L" class="nv">end</a> <span class="o">+</span> <a href="#14L" class="nv">marker</a><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="31L" class="Ln">        <a href="#16L" class="nv">beg</a> <span class="o">=</span> <a href="#11L" class="nv">text</a><span class="p">.</span><span class="nf">find</span><span class="p">(</span><a href="#14L" class="nv">marker</a><span class="p">)</span><span class="p">;</span></span>
<span id="32L" class="Ln">    <span class="p">}</span></span>
<span id="33L" class="Ln">    <a href="SimpleTemplate.hpp.html#synth::SimpleTemplate::m_literals" class="vi">m_literals</a><span class="p">.</span><span class="nf">emplace_back</span><span class="p">(</span><a href="#11L" class="nv">text</a><span class="p">.</span><span class="nf">data</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <a href="#11L" class="nv">text</a><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span></span>
<span id="34L" class="Ln">    <span class="cp">assert</span>(<a href="SimpleTemplate.hpp.html#synth::SimpleTemplate::m_literals" class="vi">m_literals</a><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="p">)</span> <span class="p">==</span> <a href="SimpleTemplate.hpp.html#synth::SimpleTemplate::m_insertionKeys" class="vi">m_insertionKeys</a><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="p">)</span> <span class="p">+</span> <span class="m">1</span>)<span class="p">;</span></span>
<span id="35L" class="Ln"><span class="p">}</span></span>
<span id="36L" class="Ln"></span>
<span id="37L" class="Ln"><span class="kd">namespace</span> <span class="p">{</span></span>
<span id="38L" class="Ln"></span>
<span id="39L" class="Ln"><span class="kd">class</span> <span class="def decl nc" id="ValVisitor">ValVisitor</span><span class="p">:</span> <span class="k">public</span> <span class="nn">boost</span><span class="p">::</span><span class="nc">static_visitor</span><span class="p">&lt;</span><span class="p">></span> <span class="p">{</span></span>
<span id="40L" class="Ln"><span class="kd">public</span><span class="p">:</span></span>
<span id="41L" class="Ln">    <span class="def decl nf" id="ValVisitor::ValVisitor:std::ostream&amp;">ValVisitor</span><span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="nc">ostream</a><span class="p">&amp;</span> <span class="def decl nv">out</span><span class="p">)</span></span>
<span id="42L" class="Ln">        <span class="p">:</span> <a href="#ValVisitor::m_out" class="vi">m_out</a><span class="p">(</span><a href="#41L" class="nv">out</a><span class="p">)</span></span>
<span id="43L" class="Ln">    <span class="p">{</span> <span class="p">}</span></span>
<span id="44L" class="Ln"></span>
<span id="45L" class="Ln">    <span class="kt">void</span> <span class="def decl " id="ValVisitor::operator():const-std::string&amp;"><span class="kd">operator</span><span class="p">(</span><span class="p">)</span></span><span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/string/basic_string" class="nc">string</a> <span class="kd">const</span><span class="p">&amp;</span> <span class="def decl nv">s</span><span class="p">)</span> <span class="p">{</span> <a href="#ValVisitor::m_out" class="vi">m_out</a> <span class="p">&lt;&lt;</span> <a href="#45L" class="nv">s</a><span class="p">;</span> <span class="p">}</span></span>
<span id="46L" class="Ln">    <span class="kt">void</span> <span class="def decl " id="ValVisitor::operator():const-SimpleTemplate::ValCallback&amp;"><span class="kd">operator</span><span class="p">(</span><span class="p">)</span></span><span class="p">(</span><a href="SimpleTemplate.hpp.html#synth::SimpleTemplate" class="nc">SimpleTemplate</a><span class="p">::</span><a href="SimpleTemplate.hpp.html#synth::SimpleTemplate::ValCallback" class="nc">ValCallback</a> <span class="kd">const</span><span class="p">&amp;</span> <span class="def decl nv">cb</span><span class="p">)</span> <span class="p">{</span> <a href="#46L" class="nv">cb</a><span class="p">(</span><a href="#ValVisitor::m_out" class="vi">m_out</a><span class="p">)</span><span class="p">;</span> <span class="p">}</span></span>
<span id="47L" class="Ln"></span>
<span id="48L" class="Ln"><span class="kd">private</span><span class="p">:</span></span>
<span id="49L" class="Ln">    <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="nc">ostream</a><span class="p">&amp;</span> <span class="def decl vi" id="ValVisitor::m_out">m_out</span><span class="p">;</span></span>
<span id="50L" class="Ln"><span class="p">}</span><span class="p">;</span></span>
<span id="51L" class="Ln"></span>
<span id="52L" class="Ln"><span class="p">}</span> <span class="c">// anonymous namespace</span></span>
<span id="53L" class="Ln"></span>
<span id="54L" class="Ln"><span class="kt">void</span> <a href="SimpleTemplate.hpp.html#synth::SimpleTemplate" class="nc">SimpleTemplate</a><span class="p">::</span><span class="def decl nf" id="synth::SimpleTemplate::writeTo:std::ostream&amp;,const-SimpleTemplate::Context&amp;">writeTo</span><span class="p">(</span></span>
<span id="55L" class="Ln">    <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/io/basic_ostream" class="nc">ostream</a><span class="p">&amp;</span> <span class="def decl nv">out</span><span class="p">,</span></span>
<span id="56L" class="Ln">    <a href="SimpleTemplate.hpp.html#synth::SimpleTemplate" class="nc">SimpleTemplate</a><span class="p">::</span><a href="SimpleTemplate.hpp.html#synth::SimpleTemplate::Context" class="nc">Context</a> <span class="kd">const</span><span class="p">&amp;</span> <span class="def decl nv">ctx</span><span class="p">)</span> <span class="kd">const</span></span>
<span id="57L" class="Ln"><span class="p">{</span></span>
<span id="58L" class="Ln">    <a href="#ValVisitor" class="nc">ValVisitor</a> <span class="def decl nv">visitor</span><span class="p">(</span><a href="#55L" class="nv">out</a><span class="p">)</span><span class="p">;</span></span>
<span id="59L" class="Ln">    <span class="k">for</span> <span class="p">(</span><a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/types/size_t" class="nc">size_t</a> <span class="def decl nv">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <a href="#59L" class="nv">i</a> <span class="o">&lt;</span> <a href="SimpleTemplate.hpp.html#synth::SimpleTemplate::m_literals" class="vi">m_literals</a><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="p">)</span><span class="p">;</span> <span class="o">++</span><a href="#59L" class="nv">i</a><span class="p">)</span> <span class="p">{</span></span>
<span id="60L" class="Ln">        <a href="#55L" class="nv">out</a> <span class="p">&lt;&lt;</span> <a href="SimpleTemplate.hpp.html#synth::SimpleTemplate::m_literals" class="vi">m_literals</a><span class="p">[</span><a href="#59L" class="nv">i</a><span class="p">]</span><span class="p">;</span></span>
<span id="61L" class="Ln">        <span class="k">if</span> <span class="p">(</span><a href="SimpleTemplate.hpp.html#synth::SimpleTemplate::m_insertionKeys" class="vi">m_insertionKeys</a><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="p">)</span> <span class="o">></span> <a href="#59L" class="nv">i</a><span class="p">)</span> <span class="p">{</span></span>
<span id="62L" class="Ln">            <span class="kd">auto</span> <span class="def decl nv">it</span> <span class="p">=</span> <a href="#56L" class="nv">ctx</a><span class="p">.</span><span class="nf">find</span><span class="p">(</span><a href="SimpleTemplate.hpp.html#synth::SimpleTemplate::m_insertionKeys" class="vi">m_insertionKeys</a><span class="p">[</span><a href="#59L" class="nv">i</a><span class="p">]</span><span class="p">)</span><span class="p">;</span></span>
<span id="63L" class="Ln">            <span class="k">if</span> <span class="p">(</span><a href="#62L" class="nv">it</a> <span class="p">==</span> <a href="#56L" class="nv">ctx</a><span class="p">.</span><span class="nf">end</span><span class="p">(</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span></span>
<span id="64L" class="Ln">                <span class="k">throw</span> <a href="http://en.cppreference.com/w/" class="nn">std</a><span class="p">::</span><a href="http://en.cppreference.com/w/cpp/error/runtime_error" class="nc">runtime_error</a><span class="p">(</span></span>
<span id="65L" class="Ln">                    <span class="s">"No value for template placeholder @@"</span></span>
<span id="66L" class="Ln">                    <span class="p">+</span> <a href="SimpleTemplate.hpp.html#synth::SimpleTemplate::m_insertionKeys" class="vi">m_insertionKeys</a><span class="p">[</span><a href="#59L" class="nv">i</a><span class="p">]</span></span>
<span id="67L" class="Ln">                    <span class="p">+</span> <span class="s">"@@ available."</span><span class="p">)</span><span class="p">;</span></span>
<span id="68L" class="Ln">            <span class="p">}</span></span>
<span id="69L" class="Ln">            <span class="nn">boost</span><span class="p">::</span><span class="nf">apply_visitor</span><span class="p">(</span><a href="#58L" class="nv">visitor</a><span class="p">,</span> <a href="#62L" class="nv">it</a><span class="p">-></span><span class="vi">second</span><span class="p">)</span><span class="p">;</span></span>
<span id="70L" class="Ln">        <span class="p">}</span></span>
<span id="71L" class="Ln">    <span class="p">}</span></span>
<span id="72L" class="Ln"><span class="p">}</span></span>
<span id="73L" class="Ln"></span>
</pre></div>
        <script src="../code.js"></script>
    </body>
</html>
